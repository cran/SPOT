<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Thomas Bartz-Beielstein" />

<meta name="date" content="2021-01-24" />

<title>SPOT Kriging Vignette</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">SPOT Kriging Vignette</h1>
<h4 class="author">Thomas Bartz-Beielstein</h4>
<h4 class="date">2021-01-24</h4>



<div id="setup" class="section level2">
<h2>Setup</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">## install.packages(&quot;devtools&quot;)</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">## devtools::install_github(&quot;r-lib/devtools&quot;)</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>url &lt;-<span class="st"> &quot;http://owos.gm.fh-koeln.de:8055/bartz/spot.git&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>devtools<span class="op">::</span><span class="kw">install_git</span>(<span class="dt">url =</span> url)</span></code></pre></div>
<ul>
<li>Package version SPOT is at least <code>2.2.4</code>.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">library</span>(<span class="st">&quot;SPOT&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">packageVersion</span>(<span class="st">&quot;SPOT&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#&gt; [1] &#39;2.2.4&#39;</span></span></code></pre></div>
<p>Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The <code>html_vignette</code> output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The <code>html_vignette</code> format:</p>
<ul>
<li>Never uses retina figures</li>
<li>Has a smaller default figure size</li>
<li>Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style</li>
</ul>
</div>
<div id="vignette-info" class="section level2">
<h2>Vignette Info</h2>
<p>Note the various macros within the <code>vignette</code> section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the <code>title</code> field and the <code>\VignetteIndexEntry</code> to match the title of your vignette.</p>
</div>
<div id="styles" class="section level2">
<h2>Styles</h2>
<p>The <code>html_vignette</code> template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:</p>
<pre><code>output: 
  rmarkdown::html_vignette:
    css: mystyles.css</code></pre>
</div>
<div id="figures" class="section level2">
<h2>Figures</h2>
<p>The figure sizes have been customised so that you can easily put two images side-by-side.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">plot</span>(<span class="dv">10</span><span class="op">:</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Plot" /><img src="data:image/png;base64,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" alt="Plot" /></p>
<p>You can enable figure captions by <code>fig_caption: yes</code> in YAML:</p>
<pre><code>output:
  rmarkdown::html_vignette:
    fig_caption: yes</code></pre>
<p>Then you can use the chunk option <code>fig.cap = &quot;Your figure caption.&quot;</code> in <strong>knitr</strong>.</p>
</div>
<div id="more-examples" class="section level2">
<h2>More Examples</h2>
<p>You can write math expressions, e.g. <span class="math inline">\(Y = X\beta + \epsilon\)</span>, footnotes<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>, and tables, e.g. using <code>knitr::kable()</code>.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mpg</th>
<th align="right">cyl</th>
<th align="right">disp</th>
<th align="right">hp</th>
<th align="right">drat</th>
<th align="right">wt</th>
<th align="right">qsec</th>
<th align="right">vs</th>
<th align="right">am</th>
<th align="right">gear</th>
<th align="right">carb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Mazda RX4</td>
<td align="right">21.0</td>
<td align="right">6</td>
<td align="right">160.0</td>
<td align="right">110</td>
<td align="right">3.90</td>
<td align="right">2.620</td>
<td align="right">16.46</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">Mazda RX4 Wag</td>
<td align="right">21.0</td>
<td align="right">6</td>
<td align="right">160.0</td>
<td align="right">110</td>
<td align="right">3.90</td>
<td align="right">2.875</td>
<td align="right">17.02</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">Datsun 710</td>
<td align="right">22.8</td>
<td align="right">4</td>
<td align="right">108.0</td>
<td align="right">93</td>
<td align="right">3.85</td>
<td align="right">2.320</td>
<td align="right">18.61</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Hornet 4 Drive</td>
<td align="right">21.4</td>
<td align="right">6</td>
<td align="right">258.0</td>
<td align="right">110</td>
<td align="right">3.08</td>
<td align="right">3.215</td>
<td align="right">19.44</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Hornet Sportabout</td>
<td align="right">18.7</td>
<td align="right">8</td>
<td align="right">360.0</td>
<td align="right">175</td>
<td align="right">3.15</td>
<td align="right">3.440</td>
<td align="right">17.02</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Valiant</td>
<td align="right">18.1</td>
<td align="right">6</td>
<td align="right">225.0</td>
<td align="right">105</td>
<td align="right">2.76</td>
<td align="right">3.460</td>
<td align="right">20.22</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Duster 360</td>
<td align="right">14.3</td>
<td align="right">8</td>
<td align="right">360.0</td>
<td align="right">245</td>
<td align="right">3.21</td>
<td align="right">3.570</td>
<td align="right">15.84</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">Merc 240D</td>
<td align="right">24.4</td>
<td align="right">4</td>
<td align="right">146.7</td>
<td align="right">62</td>
<td align="right">3.69</td>
<td align="right">3.190</td>
<td align="right">20.00</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Merc 230</td>
<td align="right">22.8</td>
<td align="right">4</td>
<td align="right">140.8</td>
<td align="right">95</td>
<td align="right">3.92</td>
<td align="right">3.150</td>
<td align="right">22.90</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Merc 280</td>
<td align="right">19.2</td>
<td align="right">6</td>
<td align="right">167.6</td>
<td align="right">123</td>
<td align="right">3.92</td>
<td align="right">3.440</td>
<td align="right">18.30</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<p>Also a quote using <code>&gt;</code>:</p>
<blockquote>
<p>“He who gives up [code] safety for [code] speed deserves neither.” (<a href="https://twitter.com/hadleywickham/status/504368538874703872">via</a>)</p>
</blockquote>
</div>
<div id="sensitivity" class="section level2">
<h2>Sensitivity</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">library</span>(sensitivity)</span>
<span id="cb6-2"><a href="#cb6-2"></a>x &lt;-<span class="st"> </span><span class="kw">morris</span>(<span class="dt">model =</span> morris.fun, <span class="dt">factors =</span> <span class="dv">20</span>, <span class="dt">r =</span> <span class="dv">4</span>,</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="dt">design =</span> <span class="kw">list</span>(<span class="dt">type =</span> <span class="st">&quot;oat&quot;</span>, <span class="dt">levels =</span> <span class="dv">5</span>, <span class="dt">grid.jump =</span> <span class="dv">3</span>))</span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="kw">print</span>(x)</span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="kw">plot</span>(x)</span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="kw">library</span>(rgl)</span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="kw">plot3d.morris</span>(x) <span class="co"># (requires the package &#39;rgl&#39;)</span></span>
<span id="cb6-8"><a href="#cb6-8"></a></span>
<span id="cb6-9"><a href="#cb6-9"></a>morris.fun_matrix &lt;-<span class="st"> </span><span class="cf">function</span>(X){ </span>
<span id="cb6-10"><a href="#cb6-10"></a>  res_vector &lt;-<span class="st"> </span><span class="kw">morris.fun</span>(X) <span class="kw">cbind</span>(res_vector, <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>res_vector)</span>
<span id="cb6-11"><a href="#cb6-11"></a>}</span>
<span id="cb6-12"><a href="#cb6-12"></a>x &lt;-<span class="st"> </span><span class="kw">morris</span>(<span class="dt">model =</span> morris.fun_matrix, <span class="dt">factors =</span> <span class="dv">20</span>, <span class="dt">r =</span> <span class="dv">4</span>,<span class="dt">design =</span> <span class="kw">list</span>(<span class="dt">type =</span> <span class="st">&quot;oat&quot;</span>, <span class="dt">levels =</span> <span class="dv">5</span>, <span class="dt">grid.jump =</span> <span class="dv">3</span>)) </span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="kw">plot</span>(x, <span class="dt">y_col =</span> <span class="dv">2</span>)</span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="kw">title</span>(<span class="dt">main =</span> <span class="st">&quot;y_col = 2&quot;</span>)</span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co"># Also only for demonstration purposes: a model function returning a # three-dimensional array</span></span>
<span id="cb6-16"><a href="#cb6-16"></a>morris.fun_array &lt;-<span class="st"> </span><span class="cf">function</span>(X){</span>
<span id="cb6-17"><a href="#cb6-17"></a>res_vector &lt;-<span class="st"> </span><span class="kw">morris.fun</span>(X)</span>
<span id="cb6-18"><a href="#cb6-18"></a>res_matrix &lt;-<span class="st"> </span><span class="kw">cbind</span>(res_vector, <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>res_vector) <span class="kw">array</span>(<span class="dt">data =</span> <span class="kw">c</span>(res_matrix, <span class="dv">5</span> <span class="op">*</span><span class="st"> </span>res_matrix),</span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="dt">dim =</span> <span class="kw">c</span>(<span class="kw">length</span>(res_vector), <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb6-20"><a href="#cb6-20"></a>}</span>
<span id="cb6-21"><a href="#cb6-21"></a>x &lt;-<span class="st"> </span><span class="kw">morris</span>(<span class="dt">model =</span> morris.fun_array, <span class="dt">factors =</span> <span class="dv">20</span>, <span class="dt">r =</span> <span class="dv">4</span>,</span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="dt">design =</span> <span class="kw">list</span>(<span class="dt">type =</span> <span class="st">&quot;simplex&quot;</span>, <span class="dt">scale.factor =</span> <span class="dv">1</span>)) <span class="kw">plot</span>(x, <span class="dt">y_col =</span> <span class="dv">2</span>, <span class="dt">y_dim3 =</span> <span class="dv">2</span>)</span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="kw">title</span>(<span class="dt">main =</span> <span class="st">&quot;y_col = 2, y_dim3 = 2&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>X.grid &lt;-<span class="st"> </span><span class="kw">parameterSets</span>(<span class="dt">par.ranges=</span><span class="kw">list</span>(<span class="dt">V1=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1000</span>),<span class="dt">V2=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)), <span class="dt">samples=</span><span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">10</span>),<span class="dt">method=</span><span class="st">&quot;grid&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">plot</span>(X.grid)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">library</span>(randtoolbox) </span>
<span id="cb8-2"><a href="#cb8-2"></a>X.sobol&lt;-<span class="kw">parameterSets</span>(<span class="dt">par.ranges=</span><span class="kw">list</span>(<span class="dt">V1=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1000</span>),<span class="dt">V2=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)),</span>
<span id="cb8-3"><a href="#cb8-3"></a>                               <span class="dt">samples=</span><span class="dv">100</span>,<span class="dt">method=</span><span class="st">&quot;sobol&quot;</span>)</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="kw">plot</span>(X.sobol)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># a 100-sample with X1 ~ U(0.5, 1.5)</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co"># X2 ~ U(1.5, 4.5)</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co"># X3 ~ U(4.5, 13.5) </span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="kw">library</span>(boot)</span>
<span id="cb9-5"><a href="#cb9-5"></a>n &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>X &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">X1 =</span> <span class="kw">runif</span>(n, <span class="fl">0.5</span>, <span class="fl">1.5</span>),</span>
<span id="cb9-7"><a href="#cb9-7"></a>                <span class="dt">X2 =</span> <span class="kw">runif</span>(n, <span class="fl">1.5</span>, <span class="fl">4.5</span>), </span>
<span id="cb9-8"><a href="#cb9-8"></a>                <span class="dt">X3 =</span> <span class="kw">runif</span>(n, <span class="fl">4.5</span>, <span class="fl">13.5</span>))</span>
<span id="cb9-9"><a href="#cb9-9"></a>    <span class="co"># linear model : Y = X1^2 + X2 + X3</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>y &lt;-<span class="st"> </span><span class="kw">with</span>(X, X1<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>X2 <span class="op">+</span>X3)</span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co"># sensitivity analysis </span></span>
<span id="cb9-12"><a href="#cb9-12"></a>x &lt;-<span class="st"> </span><span class="kw">pcc</span>(X, y, <span class="dt">nboot =</span> <span class="dv">100</span>)</span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="kw">print</span>(x)</span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="kw">plot</span>(x)</span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="kw">ggplot</span>(x)</span>
<span id="cb9-17"><a href="#cb9-17"></a></span>
<span id="cb9-18"><a href="#cb9-18"></a>x &lt;-<span class="st"> </span><span class="kw">pcc</span>(X, y, <span class="dt">semi =</span> <span class="ot">TRUE</span>, <span class="dt">nboot =</span> <span class="dv">100</span>) </span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="kw">print</span>(x)</span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="kw">plot</span>(x)</span></code></pre></div>
</div>
<div id="sequential-bifurcations" class="section level2">
<h2>sequential bifurcations</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># a model with interactions</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>p &lt;-<span class="st"> </span><span class="dv">50</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>beta &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="dt">length =</span> p)</span>
<span id="cb10-4"><a href="#cb10-4"></a>beta[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>] &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">min =</span> <span class="dv">10</span>, <span class="dt">max =</span> <span class="dv">50</span>) </span>
<span id="cb10-5"><a href="#cb10-5"></a>beta[<span class="dv">6</span><span class="op">:</span>p] &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dt">n =</span> p <span class="op">-</span><span class="st"> </span><span class="dv">5</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="fl">0.3</span>) </span>
<span id="cb10-6"><a href="#cb10-6"></a>beta &lt;-<span class="st"> </span><span class="kw">sample</span>(beta)</span>
<span id="cb10-7"><a href="#cb10-7"></a>gamma &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">data =</span> <span class="kw">runif</span>(<span class="dt">n =</span> p<span class="op">^</span><span class="dv">2</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="fl">0.1</span>), <span class="dt">nrow =</span> p, <span class="dt">ncol =</span> p) </span>
<span id="cb10-8"><a href="#cb10-8"></a>gamma[<span class="kw">lower.tri</span>(gamma, <span class="dt">diag =</span> <span class="ot">TRUE</span>)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>gamma[<span class="dv">1</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>gamma[<span class="dv">5</span>,<span class="dv">9</span>] &lt;-<span class="st"> </span><span class="dv">12</span></span>
<span id="cb10-11"><a href="#cb10-11"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x) { <span class="kw">return</span>(<span class="kw">sum</span>(x <span class="op">*</span><span class="st"> </span>beta) <span class="op">+</span><span class="st"> </span>(x <span class="op">%*%</span><span class="st"> </span>gamma <span class="op">%*%</span><span class="st"> </span>x))}</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">library</span>(babsim.hospital)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">library</span>(sensitivity)</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="kw">library</span>(SPOT)</span>
<span id="cb11-4"><a href="#cb11-4"></a>bounds &lt;-<span class="st"> </span><span class="kw">getBounds</span>()</span>
<span id="cb11-5"><a href="#cb11-5"></a>lower &lt;-<span class="st"> </span><span class="kw">matrix</span>(bounds<span class="op">$</span>lower,<span class="dv">1</span>,)</span>
<span id="cb11-6"><a href="#cb11-6"></a>upper &lt;-<span class="st"> </span><span class="kw">matrix</span>(bounds<span class="op">$</span>upper,<span class="dv">1</span>,)</span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co"># 10 iterations of SB</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>p &lt;-<span class="st"> </span><span class="dv">29</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>k =<span class="st"> </span><span class="dv">29</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>sa &lt;-<span class="st"> </span><span class="kw">sb</span>(p, <span class="dt">interaction =</span> <span class="ot">FALSE</span>) </span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span> <span class="op">:</span><span class="st"> </span>k) {</span>
<span id="cb11-12"><a href="#cb11-12"></a>  x &lt;-<span class="st"> </span><span class="kw">ask</span>(sa)</span>
<span id="cb11-13"><a href="#cb11-13"></a>  y &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">names</span>(x)) {</span>
<span id="cb11-15"><a href="#cb11-15"></a>  <span class="kw">print</span>(x[[i]])</span>
<span id="cb11-16"><a href="#cb11-16"></a>  <span class="co">## f muss eine Funktion sein, die für -1 den unteren Wert und für +1 den oberen</span></span>
<span id="cb11-17"><a href="#cb11-17"></a>  <span class="co">## Wert </span></span>
<span id="cb11-18"><a href="#cb11-18"></a>  u &lt;-<span class="st"> </span><span class="kw">matrix</span>(x[[i]],<span class="dv">1</span>,)</span>
<span id="cb11-19"><a href="#cb11-19"></a>  u &lt;-<span class="st"> </span><span class="kw">getNatDesignFromCoded</span>(u, <span class="dt">a =</span> lower, <span class="dt">b=</span>upper)</span>
<span id="cb11-20"><a href="#cb11-20"></a>  y[[i]] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>( <span class="kw">funBaBSimHospital</span>(u, <span class="dt">nCores=</span><span class="dv">20</span>) )</span>
<span id="cb11-21"><a href="#cb11-21"></a>  }</span>
<span id="cb11-22"><a href="#cb11-22"></a><span class="kw">tell</span>(sa, y) </span>
<span id="cb11-23"><a href="#cb11-23"></a>}</span>
<span id="cb11-24"><a href="#cb11-24"></a><span class="kw">print</span>(sa)</span>
<span id="cb11-25"><a href="#cb11-25"></a><span class="kw">plot</span>(sa)</span></code></pre></div>
</div>
<div id="sobol-indices" class="section level2">
<h2>Sobol Indices</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">library</span>(sensitivity)</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co"># Test case : the non-monotonic Sobol g-function</span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co"># The method of sobol requires 2 samples</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co"># (there are 8 factors, all following the uniform distribution on [0,1]) library(boot)</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>n &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>X1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="dv">8</span> <span class="op">*</span><span class="st"> </span>n), <span class="dt">nrow =</span> n))</span>
<span id="cb12-7"><a href="#cb12-7"></a>X2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="dv">8</span> <span class="op">*</span><span class="st"> </span>n), <span class="dt">nrow =</span> n))</span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="co"># sensitivity analysis</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>x &lt;-<span class="st"> </span><span class="kw">sobol</span>(<span class="dt">model =</span> sobol.fun, <span class="dt">X1 =</span> X1, <span class="dt">X2 =</span> X2, <span class="dt">order =</span> <span class="dv">2</span>, <span class="dt">nboot =</span> <span class="dv">100</span>) </span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="kw">print</span>(x)</span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="kw">plot</span>(x)</span>
<span id="cb12-12"><a href="#cb12-12"></a>    <span class="kw">library</span>(ggplot2)</span>
<span id="cb12-13"><a href="#cb12-13"></a>    <span class="kw">ggplot</span>(x)</span></code></pre></div>
<ul>
<li>When a sensitivity analysis method is called with no model (i.e. argument model = NULL), it generates an incomplete object x that stores the design of experiments (field X), allowing the user to launch “by hand” the corresponding simulations. The method tell allows to pass these simulation results to the incomplete object x, thereafter estimating the sensitivity measures.</li>
<li>tell doesn’t return anything. It computes the sensitivity measures, and stores them in the list x. Side effect: tell modifies its argument x.</li>
<li>ask returns the set of data to simulate.</li>
<li>extract returns an object, from a sobolshap_knn object, containing first-order and total Sobol indices.</li>
</ul>
<p>Example of use of fast99 with “model = NULL”</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">library</span>(sensitivity)</span>
<span id="cb13-2"><a href="#cb13-2"></a>x &lt;-<span class="st"> </span><span class="kw">fast99</span>(<span class="dt">model =</span> <span class="ot">NULL</span>, <span class="dt">factors =</span> <span class="dv">29</span>, <span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">q=</span><span class="st">&quot;qunif&quot;</span>,  <span class="dt">q.arg =</span> <span class="kw">list</span>(<span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span><span class="dv">1</span>))</span>
<span id="cb13-3"><a href="#cb13-3"></a>bounds &lt;-<span class="st"> </span><span class="kw">getBounds</span>()</span>
<span id="cb13-4"><a href="#cb13-4"></a>lower &lt;-<span class="st"> </span>bounds<span class="op">$</span>lower</span>
<span id="cb13-5"><a href="#cb13-5"></a>upper &lt;-<span class="st"> </span>bounds<span class="op">$</span>upper</span>
<span id="cb13-6"><a href="#cb13-6"></a>x1 &lt;-<span class="st"> </span><span class="kw">code2nat</span>(<span class="kw">matrix</span>(x<span class="op">$</span>X, lower, upper)</span>
<span id="cb13-7"><a href="#cb13-7"></a>y &lt;-<span class="st"> </span><span class="kw">funBaBSimHospital</span>(x1)</span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="kw">tell</span>(x,y)</span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="kw">print</span>(x)</span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="kw">plot</span>(x)</span></code></pre></div>
</div>
<div id="babsimhospital" class="section level2">
<h2>BABSimHospital</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="kw">library</span>(microbenchmark)</span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="kw">library</span>(SPOT)</span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="kw">library</span>(babsim.hospital)</span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span></code></pre></div>
<div id="compare-run-time" class="section level3">
<h3>Compare Run Time</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># n = number of function evvaluations:</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>n &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">as.numeric</span>(<span class="kw">getParaSet</span>(<span class="dv">5374</span>)[<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>]),<span class="dv">1</span>,)</span>
<span id="cb15-4"><a href="#cb15-4"></a>bounds &lt;-<span class="st"> </span><span class="kw">getBounds</span>()</span>
<span id="cb15-5"><a href="#cb15-5"></a>lower &lt;-<span class="st"> </span>bounds<span class="op">$</span>lower</span>
<span id="cb15-6"><a href="#cb15-6"></a>upper &lt;-<span class="st"> </span>bounds<span class="op">$</span>upper</span>
<span id="cb15-7"><a href="#cb15-7"></a></span>
<span id="cb15-8"><a href="#cb15-8"></a>resb &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>( </span>
<span id="cb15-9"><a href="#cb15-9"></a>  <span class="kw">spot</span>(x, funBaBSimHospital, lower , upper, <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">funEvals=</span><span class="dv">10</span><span class="op">*</span>n)), </span>
<span id="cb15-10"><a href="#cb15-10"></a>  <span class="kw">spot</span>(x, funBaBSimHospital, lower , upper, <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">funEvals=</span><span class="dv">10</span><span class="op">*</span>n, <span class="dt">model =</span> buildGaussianProcess)),</span>
<span id="cb15-11"><a href="#cb15-11"></a>  <span class="dt">times =</span> <span class="dv">2</span>)</span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="kw">print</span>(resb)</span>
<span id="cb15-13"><a href="#cb15-13"></a><span class="kw">boxplot</span>(resb)</span></code></pre></div>
</div>
<div id="babsimhospital-function" class="section level3">
<h3>BaBSimHospital Function</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="kw">library</span>(microbenchmark)</span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="kw">library</span>(SPOT)</span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="kw">library</span>(babsim.hospital)</span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb16-6"><a href="#cb16-6"></a>x0 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">as.numeric</span>(<span class="kw">getParaSet</span>(<span class="dv">5374</span>)[<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>]),<span class="dv">1</span>,)</span>
<span id="cb16-7"><a href="#cb16-7"></a>bounds &lt;-<span class="st"> </span><span class="kw">getBounds</span>()</span>
<span id="cb16-8"><a href="#cb16-8"></a>lower &lt;-<span class="st"> </span>bounds<span class="op">$</span>lower</span>
<span id="cb16-9"><a href="#cb16-9"></a>upper &lt;-<span class="st"> </span>bounds<span class="op">$</span>upper</span>
<span id="cb16-10"><a href="#cb16-10"></a></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb16-12"><a href="#cb16-12"></a>perf1 &lt;-<span class="st"> </span><span class="kw">spot</span>(<span class="dt">x=</span> x0, funBaBSimHospital, lower , upper, <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">maxTime =</span> <span class="dv">1</span>, <span class="dt">funEvals=</span><span class="dv">100</span>, <span class="dt">plots=</span><span class="ot">FALSE</span>,</span>
<span id="cb16-13"><a href="#cb16-13"></a>                                                   <span class="dt">model =</span> buildKriging, <span class="dt">optimizer=</span>optimNLOPTR), <span class="dt">nCores =</span><span class="dv">5</span>)</span>
<span id="cb16-14"><a href="#cb16-14"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb16-15"><a href="#cb16-15"></a>perf2 &lt;-<span class="st"> </span><span class="kw">spot</span>(<span class="dt">x=</span> x0, funBaBSimHospital, lower , upper, <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">maxTime =</span> <span class="dv">1</span>, <span class="dt">funEvals=</span><span class="dv">100</span>, <span class="dt">plots=</span><span class="ot">FALSE</span>,</span>
<span id="cb16-16"><a href="#cb16-16"></a>              <span class="dt">model =</span> buildGaussianProcess, <span class="dt">optimizer=</span>optimNLOPTR, <span class="dt">directOptControl =</span> <span class="kw">list</span>(<span class="dt">funEvals=</span><span class="dv">0</span>)), <span class="dt">nCores =</span><span class="dv">5</span>)</span>
<span id="cb16-17"><a href="#cb16-17"></a></span>
<span id="cb16-18"><a href="#cb16-18"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb16-19"><a href="#cb16-19"></a>perf3 &lt;-<span class="st"> </span><span class="kw">spot</span>(<span class="dt">x=</span> x0, funBaBSimHospital, lower , upper, <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">maxTime =</span> <span class="dv">1</span>, <span class="dt">funEvals=</span><span class="dv">100</span>, <span class="dt">plots=</span><span class="ot">FALSE</span>,</span>
<span id="cb16-20"><a href="#cb16-20"></a>                                                   <span class="dt">model =</span> buildGaussianProcess, <span class="dt">optimizer=</span>optimNLOPTR, </span>
<span id="cb16-21"><a href="#cb16-21"></a>                                                   <span class="dt">directOptControl =</span> <span class="kw">list</span>(<span class="dt">funEvals=</span><span class="dv">10</span>)), <span class="dt">nCores =</span> <span class="dv">5</span>)</span></code></pre></div>
</div>
</div>
<div id="sensitivity-analysis" class="section level2">
<h2>Sensitivity Analysis</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="kw">library</span>(microbenchmark)</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="kw">library</span>(SPOT)</span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="kw">library</span>(babsim.hospital)</span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb17-6"><a href="#cb17-6"></a>eps &lt;-<span class="st"> </span><span class="kw">sqrt</span>(.Machine<span class="op">$</span>double.eps)</span>
<span id="cb17-7"><a href="#cb17-7"></a>bounds &lt;-<span class="st"> </span><span class="kw">getBounds</span>()</span>
<span id="cb17-8"><a href="#cb17-8"></a>a &lt;-<span class="st"> </span><span class="kw">matrix</span>(bounds<span class="op">$</span>lower,<span class="dv">1</span>)</span>
<span id="cb17-9"><a href="#cb17-9"></a>b &lt;-<span class="st"> </span><span class="kw">matrix</span>(bounds<span class="op">$</span>upper,<span class="dv">1</span>)</span>
<span id="cb17-10"><a href="#cb17-10"></a>d &lt;-<span class="st"> </span><span class="kw">dim</span>(a)[<span class="dv">2</span>]</span>
<span id="cb17-11"><a href="#cb17-11"></a></span>
<span id="cb17-12"><a href="#cb17-12"></a>d =<span class="st"> </span><span class="dv">20</span></span>
<span id="cb17-13"><a href="#cb17-13"></a>fried &lt;-<span class="st"> </span><span class="cf">function</span> (n, d, a, b) {</span>
<span id="cb17-14"><a href="#cb17-14"></a> <span class="co">#X &lt;- designLHD(lower = lower, upper = upper, control = list(size = n))</span></span>
<span id="cb17-15"><a href="#cb17-15"></a>  X &lt;-<span class="st"> </span>lhs<span class="op">::</span><span class="kw">randomLHS</span>(n, d)</span>
<span id="cb17-16"><a href="#cb17-16"></a>  <span class="co">##XX &lt;- code2nat(x=X, a=a, b=b)</span></span>
<span id="cb17-17"><a href="#cb17-17"></a>  <span class="co">###Ytrue &lt;- funBaBSimHospital(XX, totalRepeats = 5, nCores = 5)</span></span>
<span id="cb17-18"><a href="#cb17-18"></a>  Ytrue &lt;-<span class="st"> </span><span class="kw">funSphere</span>(X[,<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb17-19"><a href="#cb17-19"></a>  Y &lt;-<span class="st"> </span>Ytrue</span>
<span id="cb17-20"><a href="#cb17-20"></a><span class="co"># Y &lt;- Ytrue + rnorm(n, 0, 1)</span></span>
<span id="cb17-21"><a href="#cb17-21"></a><span class="kw">return</span>(<span class="kw">data.frame</span>(X, Y, Ytrue))</span>
<span id="cb17-22"><a href="#cb17-22"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>data &lt;-<span class="st"> </span><span class="kw">fried</span>(<span class="dt">n=</span><span class="dv">25</span><span class="op">*</span>d, <span class="dt">d=</span>d, <span class="dt">a=</span>a, <span class="dt">b=</span>b)</span>
<span id="cb18-2"><a href="#cb18-2"></a>x=<span class="kw">as.matrix</span>(data[,<span class="dv">1</span><span class="op">:</span>d])</span>
<span id="cb18-3"><a href="#cb18-3"></a>y=data<span class="op">$</span>Y</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>fitTree &lt;-<span class="st"> </span><span class="kw">buildTreeModel</span>(x,y)</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="kw">plot</span>(fitTree)</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>fitKrigingDACE &lt;-<span class="st"> </span><span class="kw">buildKrigingDACE</span>(x,y)</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="kw">print</span>(fitKrigingDACE<span class="op">$</span>like)</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>N &lt;-<span class="st"> </span><span class="dv">100</span><span class="op">*</span>d</span>
<span id="cb21-2"><a href="#cb21-2"></a>G &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">*</span>d</span>
<span id="cb21-3"><a href="#cb21-3"></a>m &lt;-<span class="st"> </span>q1 &lt;-<span class="st"> </span>q2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">ncol=</span>d, <span class="dt">nrow=</span>G) </span>
<span id="cb21-4"><a href="#cb21-4"></a>grid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length=</span>G)</span>
<span id="cb21-5"><a href="#cb21-5"></a>XX &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">ncol=</span>d, <span class="dt">nrow=</span>N)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>bounds &lt;-<span class="st"> </span><span class="kw">getBounds</span>()</span>
<span id="cb22-2"><a href="#cb22-2"></a>a &lt;-<span class="st"> </span><span class="kw">matrix</span>(bounds<span class="op">$</span>lower,<span class="dv">1</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a>b &lt;-<span class="st"> </span><span class="kw">matrix</span>(bounds<span class="op">$</span>upper,<span class="dv">1</span>)</span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>d) </span>
<span id="cb22-5"><a href="#cb22-5"></a>  { <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>G) {</span>
<span id="cb22-6"><a href="#cb22-6"></a>  XX[,j] &lt;-<span class="st"> </span>grid[i]</span>
<span id="cb22-7"><a href="#cb22-7"></a>  XX[,<span class="op">-</span>j] &lt;-<span class="st"> </span>lhs<span class="op">::</span><span class="kw">randomLHS</span>(N, d<span class="dv">-1</span>)</span>
<span id="cb22-8"><a href="#cb22-8"></a>  <span class="co">## XX &lt;- code2nat(XX, a, b)</span></span>
<span id="cb22-9"><a href="#cb22-9"></a>  <span class="co">##p &lt;- laGP::predGPsep(gpi, XX, lite=TRUE, nonug=TRUE) </span></span>
<span id="cb22-10"><a href="#cb22-10"></a>  fitKrigingDACE<span class="op">$</span>target &lt;-<span class="st"> &quot;s&quot;</span></span>
<span id="cb22-11"><a href="#cb22-11"></a>  p &lt;-<span class="st"> </span><span class="kw">predict</span>(fitKrigingDACE, XX)</span>
<span id="cb22-12"><a href="#cb22-12"></a>  m[i,j] &lt;-<span class="st"> </span><span class="kw">mean</span>(p<span class="op">$</span>y)</span>
<span id="cb22-13"><a href="#cb22-13"></a>  <span class="co">## m[i,j] &lt;- mean(p$mean)</span></span>
<span id="cb22-14"><a href="#cb22-14"></a>  <span class="co">## q1[i,j] &lt;- mean(qnorm(0.05, p$mean, sqrt(p$s2))) </span></span>
<span id="cb22-15"><a href="#cb22-15"></a>  <span class="co">## q2[i,j] &lt;- mean(qnorm(0.95, p$mean, sqrt(p$s2)))</span></span>
<span id="cb22-16"><a href="#cb22-16"></a>  q1[i,j] &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">qnorm</span>(<span class="fl">0.05</span>, p<span class="op">$</span>y, <span class="kw">sqrt</span>(p<span class="op">$</span>s))) </span>
<span id="cb22-17"><a href="#cb22-17"></a>  q2[i,j] &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">qnorm</span>(<span class="fl">0.95</span>, p<span class="op">$</span>y, <span class="kw">sqrt</span>(p<span class="op">$</span>s)))</span>
<span id="cb22-18"><a href="#cb22-18"></a>  </span>
<span id="cb22-19"><a href="#cb22-19"></a>  } </span>
<span id="cb22-20"><a href="#cb22-20"></a>  }</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">plot</span>(<span class="dv">0</span>, <span class="dt">xlab=</span><span class="st">&quot;grid&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;main effect&quot;</span>, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), </span>
<span id="cb23-2"><a href="#cb23-2"></a>     <span class="dt">ylim=</span><span class="kw">range</span>(<span class="kw">c</span>(q1,q2)), <span class="dt">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>d) <span class="kw">lines</span>(grid, m[,j], <span class="dt">col=</span>j, <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="kw">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;x&quot;</span>, <span class="dv">1</span><span class="op">:</span>d), <span class="dt">fill=</span><span class="dv">1</span><span class="op">:</span>d, <span class="dt">horiz=</span><span class="ot">TRUE</span>, <span class="dt">cex=</span><span class="fl">0.75</span>)</span></code></pre></div>
<div id="lagp" class="section level3">
<h3>laGP</h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>gpi &lt;-<span class="st"> </span>laGP<span class="op">::</span><span class="kw">newGPsep</span>(<span class="kw">as.matrix</span>(data[,<span class="dv">1</span><span class="op">:</span><span class="dv">29</span>]), data<span class="op">$</span>Y, <span class="dt">d=</span><span class="fl">0.1</span>,<span class="dt">g=</span><span class="kw">var</span>(data<span class="op">$</span>Y)<span class="op">/</span><span class="dv">10</span>, <span class="dt">dK=</span><span class="ot">TRUE</span>)</span>
<span id="cb24-2"><a href="#cb24-2"></a>mle &lt;-<span class="st"> </span>laGP<span class="op">::</span><span class="kw">mleGPsep</span>(gpi, <span class="dt">param=</span><span class="st">&quot;both&quot;</span>, <span class="dt">tmin=</span><span class="kw">rep</span>(eps, <span class="dv">2</span>),</span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="dt">tmax=</span><span class="kw">c</span>(<span class="dv">10</span>, <span class="kw">var</span>(data<span class="op">$</span>Y)))</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>N &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>G &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>m &lt;-<span class="st"> </span>q1 &lt;-<span class="st"> </span>q2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">ncol=</span><span class="dv">29</span>, <span class="dt">nrow=</span>G) </span>
<span id="cb25-4"><a href="#cb25-4"></a>grid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length=</span>G)</span>
<span id="cb25-5"><a href="#cb25-5"></a>XX &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">ncol=</span><span class="dv">29</span>, <span class="dt">nrow=</span>N)</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>bounds &lt;-<span class="st"> </span><span class="kw">getBounds</span>()</span>
<span id="cb26-2"><a href="#cb26-2"></a>a &lt;-<span class="st"> </span><span class="kw">matrix</span>(bounds<span class="op">$</span>lower,<span class="dv">1</span>)</span>
<span id="cb26-3"><a href="#cb26-3"></a>b &lt;-<span class="st"> </span><span class="kw">matrix</span>(bounds<span class="op">$</span>upper,<span class="dv">1</span>)</span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">29</span>) </span>
<span id="cb26-5"><a href="#cb26-5"></a>  { <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>G) {</span>
<span id="cb26-6"><a href="#cb26-6"></a>  XX[,j] &lt;-<span class="st"> </span>grid[i]</span>
<span id="cb26-7"><a href="#cb26-7"></a>  XX[,<span class="op">-</span>j] &lt;-<span class="st"> </span>lhs<span class="op">::</span><span class="kw">randomLHS</span>(N, <span class="dv">28</span>)</span>
<span id="cb26-8"><a href="#cb26-8"></a>  <span class="co">## XXX &lt;- code2nat(XX, a, b)</span></span>
<span id="cb26-9"><a href="#cb26-9"></a>  p &lt;-<span class="st"> </span>laGP<span class="op">::</span><span class="kw">predGPsep</span>(gpi, XX, <span class="dt">lite=</span><span class="ot">TRUE</span>, <span class="dt">nonug=</span><span class="ot">TRUE</span>) </span>
<span id="cb26-10"><a href="#cb26-10"></a>  m[i,j] &lt;-<span class="st"> </span><span class="kw">mean</span>(p<span class="op">$</span>mean)</span>
<span id="cb26-11"><a href="#cb26-11"></a>  q1[i,j] &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">qnorm</span>(<span class="fl">0.05</span>, p<span class="op">$</span>mean, <span class="kw">sqrt</span>(p<span class="op">$</span>s2))) </span>
<span id="cb26-12"><a href="#cb26-12"></a>  q2[i,j] &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">qnorm</span>(<span class="fl">0.95</span>, p<span class="op">$</span>mean, <span class="kw">sqrt</span>(p<span class="op">$</span>s2)))</span>
<span id="cb26-13"><a href="#cb26-13"></a>  } </span>
<span id="cb26-14"><a href="#cb26-14"></a>  }</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="kw">plot</span>(<span class="dv">0</span>, <span class="dt">xlab=</span><span class="st">&quot;grid&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;main effect&quot;</span>, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), </span>
<span id="cb27-2"><a href="#cb27-2"></a>     <span class="dt">ylim=</span><span class="kw">range</span>(<span class="kw">c</span>(q1,q2)), <span class="dt">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">29</span>) <span class="kw">lines</span>(grid, m[,j], <span class="dt">col=</span>j, <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="kw">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;x&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">29</span>), <span class="dt">fill=</span><span class="dv">1</span><span class="op">:</span><span class="dv">29</span>, <span class="dt">horiz=</span><span class="ot">TRUE</span>, <span class="dt">cex=</span><span class="fl">0.75</span>)</span></code></pre></div>
</div>
<div id="sphere-function" class="section level3">
<h3>Sphere Function</h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># n = problem dim</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>n &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>low =<span class="st"> </span><span class="dv">-2</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>up =<span class="st"> </span><span class="dv">2</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>a =<span class="st"> </span><span class="kw">runif</span>(n, low, <span class="dv">0</span>)</span>
<span id="cb28-6"><a href="#cb28-6"></a>b =<span class="st"> </span><span class="kw">runif</span>(n, <span class="dv">0</span>, up)</span>
<span id="cb28-7"><a href="#cb28-7"></a>x0 =<span class="st"> </span>a <span class="op">+</span><span class="st"> </span><span class="kw">runif</span>(n)<span class="op">*</span>(b<span class="op">-</span>a)</span>
<span id="cb28-8"><a href="#cb28-8"></a><span class="co">#plot(a, type = &quot;l&quot;, ylim=c(up,low))</span></span>
<span id="cb28-9"><a href="#cb28-9"></a><span class="co">#lines(b)</span></span>
<span id="cb28-10"><a href="#cb28-10"></a><span class="co">#lines(x0)</span></span>
<span id="cb28-11"><a href="#cb28-11"></a>x0 =<span class="st"> </span><span class="kw">matrix</span>( x0, <span class="dt">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb28-12"><a href="#cb28-12"></a></span>
<span id="cb28-13"><a href="#cb28-13"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb28-14"><a href="#cb28-14"></a>perf1 &lt;-<span class="st"> </span><span class="kw">spot</span>(<span class="dt">x=</span> x0, funSphere, a, b, <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">maxTime =</span> <span class="fl">0.25</span>, <span class="dt">funEvals=</span><span class="dv">10</span><span class="op">*</span>n, <span class="dt">plots=</span><span class="ot">TRUE</span>,</span>
<span id="cb28-15"><a href="#cb28-15"></a>                                                   <span class="dt">model =</span> buildKriging, <span class="dt">optimizer=</span>optimNLOPTR))</span>
<span id="cb28-16"><a href="#cb28-16"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb28-17"><a href="#cb28-17"></a>perf2 &lt;-<span class="st"> </span><span class="kw">spot</span>(<span class="dt">x=</span> x0, funSphere, a, b, <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">maxTime =</span> <span class="fl">0.25</span>, <span class="dt">funEvals=</span><span class="dv">10</span><span class="op">*</span>n, <span class="dt">plots=</span><span class="ot">TRUE</span>,</span>
<span id="cb28-18"><a href="#cb28-18"></a>              <span class="dt">model =</span> buildGaussianProcess, <span class="dt">optimizer=</span>optimNLOPTR, <span class="dt">directOptControl =</span> <span class="kw">list</span>(<span class="dt">funEvals=</span><span class="dv">0</span>)))</span>
<span id="cb28-19"><a href="#cb28-19"></a></span>
<span id="cb28-20"><a href="#cb28-20"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb28-21"><a href="#cb28-21"></a>perf3 &lt;-<span class="st"> </span><span class="kw">spot</span>(<span class="dt">x=</span> x0, funSphere, a, b, <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">maxTime =</span> <span class="fl">0.25</span>, <span class="dt">funEvals=</span><span class="dv">10</span><span class="op">*</span>n, <span class="dt">plots=</span><span class="ot">TRUE</span>,</span>
<span id="cb28-22"><a href="#cb28-22"></a>                                                   <span class="dt">model =</span> buildGaussianProcess, <span class="dt">optimizer=</span>optimNLOPTR, </span>
<span id="cb28-23"><a href="#cb28-23"></a>                                                   <span class="dt">directOptControl =</span> <span class="kw">list</span>(<span class="dt">funEvals=</span><span class="dv">10</span>)))</span></code></pre></div>
</div>
<div id="quality-results-plot-repeats-sphere-function" class="section level3">
<h3>Quality Results: Plot Repeats (Sphere Function)</h3>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())</span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="kw">library</span>(microbenchmark)</span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="kw">library</span>(SPOT)</span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb29-5"><a href="#cb29-5"></a>n &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>low =<span class="st"> </span><span class="dv">-2</span></span>
<span id="cb29-7"><a href="#cb29-7"></a>up =<span class="st"> </span><span class="dv">2</span></span>
<span id="cb29-8"><a href="#cb29-8"></a>a =<span class="st"> </span><span class="kw">runif</span>(n, low, <span class="dv">0</span>)</span>
<span id="cb29-9"><a href="#cb29-9"></a>b =<span class="st"> </span><span class="kw">runif</span>(n, <span class="dv">0</span>, up)</span>
<span id="cb29-10"><a href="#cb29-10"></a>x0 =<span class="st"> </span>a <span class="op">+</span><span class="st"> </span><span class="kw">runif</span>(n)<span class="op">*</span>(b<span class="op">-</span>a)</span>
<span id="cb29-11"><a href="#cb29-11"></a><span class="co">#plot(a, type = &quot;l&quot;, ylim=c(up,low))</span></span>
<span id="cb29-12"><a href="#cb29-12"></a><span class="co">#lines(b)</span></span>
<span id="cb29-13"><a href="#cb29-13"></a><span class="co">#lines(x0)</span></span>
<span id="cb29-14"><a href="#cb29-14"></a>x0 =<span class="st"> </span><span class="kw">matrix</span>( x0, <span class="dt">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb29-15"><a href="#cb29-15"></a></span>
<span id="cb29-16"><a href="#cb29-16"></a>reps &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb29-17"><a href="#cb29-17"></a>end &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">*</span>n</span>
<span id="cb29-18"><a href="#cb29-18"></a>ninit &lt;-<span class="st"> </span>n</span>
<span id="cb29-19"><a href="#cb29-19"></a></span>
<span id="cb29-20"><a href="#cb29-20"></a>progSpot &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> reps, <span class="dt">ncol =</span> end)</span>
<span id="cb29-21"><a href="#cb29-21"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps){</span>
<span id="cb29-22"><a href="#cb29-22"></a>  <span class="kw">set.seed</span>(r)</span>
<span id="cb29-23"><a href="#cb29-23"></a>  x0 &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span><span class="kw">runif</span>(n)<span class="op">*</span>(b<span class="op">-</span>a)</span>
<span id="cb29-24"><a href="#cb29-24"></a>  x0 =<span class="st"> </span><span class="kw">matrix</span>( x0, <span class="dt">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb29-25"><a href="#cb29-25"></a>  sol &lt;-<span class="st"> </span><span class="kw">spot</span>(<span class="dt">x=</span> x0, funSphere, a, b, <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">funEvals=</span>end,</span>
<span id="cb29-26"><a href="#cb29-26"></a>                                                   <span class="dt">model =</span> buildGaussianProcess,</span>
<span id="cb29-27"><a href="#cb29-27"></a>                                                   <span class="dt">optimizer=</span>optimNLOPTR, </span>
<span id="cb29-28"><a href="#cb29-28"></a>                                                   <span class="dt">directOptControl =</span> <span class="kw">list</span>(<span class="dt">funEvals=</span><span class="dv">0</span>),</span>
<span id="cb29-29"><a href="#cb29-29"></a>                                                   <span class="dt">designControl =</span> <span class="kw">list</span>(<span class="dt">size =</span> ninit)))</span>
<span id="cb29-30"><a href="#cb29-30"></a>  progSpot[r, ] &lt;-<span class="st"> </span><span class="kw">bov</span>(sol<span class="op">$</span>y, end)</span>
<span id="cb29-31"><a href="#cb29-31"></a>  </span>
<span id="cb29-32"><a href="#cb29-32"></a>}</span>
<span id="cb29-33"><a href="#cb29-33"></a></span>
<span id="cb29-34"><a href="#cb29-34"></a><span class="kw">matplot</span>(<span class="kw">t</span>(progSpot), <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">col=</span><span class="st">&quot;gray&quot;</span>, <span class="dt">lty=</span><span class="dv">1</span>,</span>
<span id="cb29-35"><a href="#cb29-35"></a>        <span class="dt">xlab=</span><span class="st">&quot;n: blackbox evaluations&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;best objective value&quot;</span>)</span>
<span id="cb29-36"><a href="#cb29-36"></a><span class="kw">abline</span>(<span class="dt">v=</span>ninit, <span class="dt">lty=</span><span class="dv">2</span>)</span>
<span id="cb29-37"><a href="#cb29-37"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="st">&quot;seed LHS&quot;</span>, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb29-38"><a href="#cb29-38"></a></span>
<span id="cb29-39"><a href="#cb29-39"></a>f &lt;-<span class="st"> </span>funSphere</span>
<span id="cb29-40"><a href="#cb29-40"></a></span>
<span id="cb29-41"><a href="#cb29-41"></a></span>
<span id="cb29-42"><a href="#cb29-42"></a>fprime &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb29-43"><a href="#cb29-43"></a>  x &lt;-<span class="st"> </span><span class="kw">matrix</span>( x, <span class="dv">1</span>)</span>
<span id="cb29-44"><a href="#cb29-44"></a>  ynew &lt;-<span class="st"> </span><span class="kw">as.vector</span>(<span class="kw">f</span>(x))</span>
<span id="cb29-45"><a href="#cb29-45"></a>  y &lt;&lt;-<span class="st"> </span><span class="kw">c</span>(y, ynew) </span>
<span id="cb29-46"><a href="#cb29-46"></a>  <span class="kw">return</span>(ynew)</span>
<span id="cb29-47"><a href="#cb29-47"></a>}</span>
<span id="cb29-48"><a href="#cb29-48"></a></span>
<span id="cb29-49"><a href="#cb29-49"></a>progOptim &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow=</span>reps, <span class="dt">ncol=</span>end) </span>
<span id="cb29-50"><a href="#cb29-50"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps) {</span>
<span id="cb29-51"><a href="#cb29-51"></a>  y &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb29-52"><a href="#cb29-52"></a>  x0 &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span><span class="kw">runif</span>(n)<span class="op">*</span>(b<span class="op">-</span>a)</span>
<span id="cb29-53"><a href="#cb29-53"></a>  x0 &lt;-<span class="st"> </span><span class="kw">matrix</span>( x0, <span class="dv">1</span>, )</span>
<span id="cb29-54"><a href="#cb29-54"></a>  os &lt;-<span class="st"> </span><span class="kw">optim</span>(x0, fprime, <span class="dt">lower=</span>a, <span class="dt">upper=</span>b, <span class="dt">method=</span><span class="st">&quot;L-BFGS-B&quot;</span>) </span>
<span id="cb29-55"><a href="#cb29-55"></a>  progOptim[r,] &lt;-<span class="st"> </span><span class="kw">bov</span>(y, end)</span>
<span id="cb29-56"><a href="#cb29-56"></a>}</span>
<span id="cb29-57"><a href="#cb29-57"></a></span>
<span id="cb29-58"><a href="#cb29-58"></a><span class="kw">matplot</span>(<span class="kw">t</span>(progOptim), <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lty=</span><span class="dv">1</span>,</span>
<span id="cb29-59"><a href="#cb29-59"></a>        <span class="dt">xlab=</span><span class="st">&quot;n: blackbox evaluations&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;best objective value&quot;</span>)</span>
<span id="cb29-60"><a href="#cb29-60"></a><span class="kw">matlines</span>(<span class="kw">t</span>(progSpot), <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">col=</span><span class="st">&quot;gray&quot;</span>, <span class="dt">lty=</span><span class="dv">1</span>)</span>
<span id="cb29-61"><a href="#cb29-61"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;Spot&quot;</span>, <span class="st">&quot;optim&quot;</span>), <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;gray&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co">### babsim.hospital</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())</span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="kw">library</span>(microbenchmark)</span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="kw">library</span>(SPOT)</span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="kw">library</span>(babsim.hospital)</span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="kw">library</span>(nloptr)</span>
<span id="cb30-7"><a href="#cb30-7"></a><span class="kw">library</span>(parallel)</span>
<span id="cb30-8"><a href="#cb30-8"></a></span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="co">### New Babsim</span></span>
<span id="cb30-10"><a href="#cb30-10"></a>getParallelBaseObjFun &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">region =</span> <span class="dv">5374</span>, <span class="dt">nCores =</span> <span class="dv">2</span>){</span>
<span id="cb30-11"><a href="#cb30-11"></a>  N_REPEATS =<span class="st"> </span><span class="dv">10</span><span class="op">/</span>nCores <span class="co">## cores are used in parallel, change repeats if desired</span></span>
<span id="cb30-12"><a href="#cb30-12"></a>  singleRepeat &lt;-<span class="st"> </span><span class="cf">function</span>(index, x){</span>
<span id="cb30-13"><a href="#cb30-13"></a>    rkiwerte =<span class="st"> </span>babsim.hospital<span class="op">::</span>rkidata</span>
<span id="cb30-14"><a href="#cb30-14"></a>    icuwerte =<span class="st"> </span>babsim.hospital<span class="op">::</span>icudata</span>
<span id="cb30-15"><a href="#cb30-15"></a>    rkiwerte &lt;-<span class="st"> </span>rkiwerte[rkiwerte<span class="op">$</span>Refdatum <span class="op">&lt;=</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2020-12-09&quot;</span>),]</span>
<span id="cb30-16"><a href="#cb30-16"></a>    icuwerte &lt;-<span class="st"> </span>icuwerte[icuwerte<span class="op">$</span>daten_stand <span class="op">&lt;=</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2020-12-09&quot;</span>),]</span>
<span id="cb30-17"><a href="#cb30-17"></a>    region &lt;-<span class="st"> </span><span class="dv">5374</span></span>
<span id="cb30-18"><a href="#cb30-18"></a>    fun &lt;-<span class="st"> </span>babsim.hospital<span class="op">:::</span><span class="kw">getTrainTestObjFun</span>(<span class="dt">region =</span> region,</span>
<span id="cb30-19"><a href="#cb30-19"></a>                                                <span class="dt">rkiwerte =</span> rkiwerte,</span>
<span id="cb30-20"><a href="#cb30-20"></a>                                                <span class="dt">icuwerte =</span> icuwerte,</span>
<span id="cb30-21"><a href="#cb30-21"></a>                                                <span class="dt">TrainSimStartDate =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2020-12-09&quot;</span>) <span class="op">-</span><span class="st"> </span><span class="dv">10</span><span class="op">*</span><span class="dv">7</span>, </span>
<span id="cb30-22"><a href="#cb30-22"></a>                                                <span class="dt">TrainFieldStartDate =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2020-12-09&quot;</span>) <span class="op">-</span><span class="st"> </span><span class="dv">6</span><span class="op">*</span><span class="dv">7</span>,</span>
<span id="cb30-23"><a href="#cb30-23"></a>                                                <span class="dt">tryOnTestSet =</span> <span class="ot">FALSE</span>)</span>
<span id="cb30-24"><a href="#cb30-24"></a>    <span class="kw">fun</span>(x)</span>
<span id="cb30-25"><a href="#cb30-25"></a>  }</span>
<span id="cb30-26"><a href="#cb30-26"></a>  <span class="cf">function</span>(x){</span>
<span id="cb30-27"><a href="#cb30-27"></a>    res &lt;-<span class="st"> </span><span class="kw">mclapply</span>(<span class="dv">1</span><span class="op">:</span>N_REPEATS, singleRepeat, x, <span class="dt">mc.cores =</span> nCores)</span>
<span id="cb30-28"><a href="#cb30-28"></a>    y &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(res))</span>
<span id="cb30-29"><a href="#cb30-29"></a>    <span class="kw">median</span>(y)</span>
<span id="cb30-30"><a href="#cb30-30"></a>  }</span>
<span id="cb30-31"><a href="#cb30-31"></a>}</span>
<span id="cb30-32"><a href="#cb30-32"></a><span class="co">## Call Example</span></span>
<span id="cb30-33"><a href="#cb30-33"></a>objFun &lt;-<span class="st"> </span><span class="kw">getParallelBaseObjFun</span>()</span>
<span id="cb30-34"><a href="#cb30-34"></a><span class="kw">objFun</span>(<span class="kw">as.numeric</span>(babsim.hospital<span class="op">::</span><span class="kw">getParaSet</span>(<span class="dv">5315</span>)[<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>]))</span>
<span id="cb30-35"><a href="#cb30-35"></a></span>
<span id="cb30-36"><a href="#cb30-36"></a></span>
<span id="cb30-37"><a href="#cb30-37"></a></span>
<span id="cb30-38"><a href="#cb30-38"></a><span class="co">### Old Version</span></span>
<span id="cb30-39"><a href="#cb30-39"></a><span class="kw">packageVersion</span>(<span class="st">&quot;babsim.hospital&quot;</span>)</span>
<span id="cb30-40"><a href="#cb30-40"></a>funHosp &lt;-<span class="st"> </span><span class="kw">getTrainTestObjFun</span>(<span class="dt">verbosity =</span> <span class="dv">10000</span>,</span>
<span id="cb30-41"><a href="#cb30-41"></a>                          <span class="dt">parallel=</span><span class="ot">TRUE</span>,</span>
<span id="cb30-42"><a href="#cb30-42"></a>                          <span class="dt">tryOnTestSet=</span><span class="ot">FALSE</span>,</span>
<span id="cb30-43"><a href="#cb30-43"></a>                          <span class="dt">TrainSimStartDate =</span> <span class="kw">Sys.Date</span>() <span class="op">-</span><span class="st"> </span><span class="dv">12</span> <span class="op">*</span><span class="st"> </span><span class="dv">7</span>)</span>
<span id="cb30-44"><a href="#cb30-44"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x)</span>
<span id="cb30-45"><a href="#cb30-45"></a>{<span class="kw">matrix</span>(<span class="kw">apply</span>(x, <span class="co"># matrix</span></span>
<span id="cb30-46"><a href="#cb30-46"></a>              <span class="dv">1</span>, <span class="co"># margin (apply over rows) </span></span>
<span id="cb30-47"><a href="#cb30-47"></a>              funHosp),</span>
<span id="cb30-48"><a href="#cb30-48"></a>        ,<span class="dv">1</span>) <span class="co"># number of columns</span></span>
<span id="cb30-49"><a href="#cb30-49"></a>}</span>
<span id="cb30-50"><a href="#cb30-50"></a></span>
<span id="cb30-51"><a href="#cb30-51"></a>lo &lt;-<span class="st"> </span><span class="kw">getBounds</span>()<span class="op">$</span>lower</span>
<span id="cb30-52"><a href="#cb30-52"></a>up &lt;-<span class="st"> </span><span class="kw">getBounds</span>()<span class="op">$</span>upper</span>
<span id="cb30-53"><a href="#cb30-53"></a></span>
<span id="cb30-54"><a href="#cb30-54"></a>n &lt;-<span class="st"> </span><span class="kw">length</span>(lo)</span>
<span id="cb30-55"><a href="#cb30-55"></a>reps &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb30-56"><a href="#cb30-56"></a>end &lt;-<span class="st"> </span><span class="dv">3</span><span class="op">*</span>n</span>
<span id="cb30-57"><a href="#cb30-57"></a>ninit &lt;-<span class="st"> </span>n<span class="op">+</span><span class="dv">1</span></span>
<span id="cb30-58"><a href="#cb30-58"></a></span>
<span id="cb30-59"><a href="#cb30-59"></a>para &lt;-<span class="st"> </span><span class="kw">getStartParameter</span>(<span class="dt">region =</span> <span class="dv">5374</span>)</span>
<span id="cb30-60"><a href="#cb30-60"></a></span>
<span id="cb30-61"><a href="#cb30-61"></a>progSpot &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> reps, <span class="dt">ncol =</span> end)</span>
<span id="cb30-62"><a href="#cb30-62"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps){</span>
<span id="cb30-63"><a href="#cb30-63"></a>  <span class="kw">set.seed</span>(r)</span>
<span id="cb30-64"><a href="#cb30-64"></a>  x0 &lt;-<span class="st"> </span>para[<span class="dv">1</span>,]</span>
<span id="cb30-65"><a href="#cb30-65"></a>  x0 =<span class="st"> </span><span class="kw">matrix</span>( x0, <span class="dt">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb30-66"><a href="#cb30-66"></a>  sol &lt;-<span class="st"> </span><span class="kw">spot</span>(<span class="dt">x=</span> x0, f, lo, up, <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">funEvals=</span>end,</span>
<span id="cb30-67"><a href="#cb30-67"></a>                                                   <span class="dt">model =</span> buildGaussianProcess,</span>
<span id="cb30-68"><a href="#cb30-68"></a>                                                   <span class="dt">optimizer=</span>optimNLOPTR, </span>
<span id="cb30-69"><a href="#cb30-69"></a>                                                   <span class="dt">directOptControl =</span> <span class="kw">list</span>(<span class="dt">funEvals=</span> n),</span>
<span id="cb30-70"><a href="#cb30-70"></a>                                                   <span class="dt">designControl =</span> <span class="kw">list</span>(<span class="dt">size =</span> ninit)))</span>
<span id="cb30-71"><a href="#cb30-71"></a>  progSpot[r, ] &lt;-<span class="st"> </span><span class="kw">bov</span>(sol<span class="op">$</span>y, end)</span>
<span id="cb30-72"><a href="#cb30-72"></a>  </span>
<span id="cb30-73"><a href="#cb30-73"></a>}</span>
<span id="cb30-74"><a href="#cb30-74"></a></span>
<span id="cb30-75"><a href="#cb30-75"></a><span class="kw">matplot</span>(<span class="kw">t</span>(progSpot), <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">col=</span><span class="st">&quot;gray&quot;</span>, <span class="dt">lty=</span><span class="dv">1</span>,</span>
<span id="cb30-76"><a href="#cb30-76"></a>        <span class="dt">xlab=</span><span class="st">&quot;n: blackbox evaluations&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;best objective value&quot;</span>)</span>
<span id="cb30-77"><a href="#cb30-77"></a><span class="kw">abline</span>(<span class="dt">v=</span>ninit, <span class="dt">lty=</span><span class="dv">2</span>)</span>
<span id="cb30-78"><a href="#cb30-78"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="st">&quot;seed LHS&quot;</span>, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb30-79"><a href="#cb30-79"></a></span>
<span id="cb30-80"><a href="#cb30-80"></a><span class="co">## f &lt;- funSphere</span></span>
<span id="cb30-81"><a href="#cb30-81"></a></span>
<span id="cb30-82"><a href="#cb30-82"></a>fprime &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb30-83"><a href="#cb30-83"></a>  x &lt;-<span class="st"> </span><span class="kw">matrix</span>( x, <span class="dv">1</span>)</span>
<span id="cb30-84"><a href="#cb30-84"></a>  ynew &lt;-<span class="st"> </span><span class="kw">as.vector</span>(<span class="kw">f</span>(x))</span>
<span id="cb30-85"><a href="#cb30-85"></a>  y &lt;&lt;-<span class="st"> </span><span class="kw">c</span>(y, ynew) </span>
<span id="cb30-86"><a href="#cb30-86"></a>  <span class="kw">return</span>(ynew)</span>
<span id="cb30-87"><a href="#cb30-87"></a>}</span>
<span id="cb30-88"><a href="#cb30-88"></a></span>
<span id="cb30-89"><a href="#cb30-89"></a>progOptim &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow=</span>reps, <span class="dt">ncol=</span>end) </span>
<span id="cb30-90"><a href="#cb30-90"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps) {</span>
<span id="cb30-91"><a href="#cb30-91"></a>  y &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb30-92"><a href="#cb30-92"></a>  x0 &lt;-<span class="st"> </span>para[<span class="dv">1</span>,]</span>
<span id="cb30-93"><a href="#cb30-93"></a>  x0 &lt;-<span class="st"> </span><span class="kw">matrix</span>( x0, <span class="dv">1</span>, )</span>
<span id="cb30-94"><a href="#cb30-94"></a>  os &lt;-<span class="st"> </span><span class="kw">optim</span>(x0, fprime, <span class="dt">lower=</span>lo, <span class="dt">upper=</span>up, <span class="dt">method=</span><span class="st">&quot;L-BFGS-B&quot;</span>,  <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">maxit =</span> end)) </span>
<span id="cb30-95"><a href="#cb30-95"></a>  progOptim[r,] &lt;-<span class="st"> </span><span class="kw">bov</span>(y, end)</span>
<span id="cb30-96"><a href="#cb30-96"></a>}</span>
<span id="cb30-97"><a href="#cb30-97"></a></span>
<span id="cb30-98"><a href="#cb30-98"></a></span>
<span id="cb30-99"><a href="#cb30-99"></a><span class="kw">matplot</span>(<span class="kw">t</span>(progOptim), <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lty=</span><span class="dv">1</span>,</span>
<span id="cb30-100"><a href="#cb30-100"></a>        <span class="dt">xlab=</span><span class="st">&quot;n: blackbox evaluations&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;best objective value&quot;</span>)</span>
<span id="cb30-101"><a href="#cb30-101"></a><span class="kw">matlines</span>(<span class="kw">t</span>(progSpot), <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">col=</span><span class="st">&quot;gray&quot;</span>, <span class="dt">lty=</span><span class="dv">1</span>)</span>
<span id="cb30-102"><a href="#cb30-102"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;Spot&quot;</span>, <span class="st">&quot;optim&quot;</span>), <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;gray&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="lagp-1" class="section level2">
<h2>laGP</h2>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">library</span>(<span class="st">&quot;laGP&quot;</span>)</span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="kw">library</span>(<span class="st">&quot;MASS&quot;</span>)</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="kw">library</span>(<span class="st">&quot;lhs&quot;</span>)</span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="kw">library</span>(<span class="st">&quot;akima&quot;</span>)</span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="kw">library</span>(<span class="st">&quot;tgp&quot;</span>)</span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="kw">library</span>(<span class="st">&quot;SPOT&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>N &lt;-<span class="st"> </span><span class="dv">200</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>x &lt;-<span class="st"> </span><span class="kw">matrix</span>( <span class="kw">seq</span>(<span class="dt">from=</span><span class="op">-</span><span class="dv">1</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">length.out =</span> N), <span class="dt">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb32-3"><a href="#cb32-3"></a>y &lt;-<span class="st"> </span><span class="kw">funSphere</span>(x)  <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dv">0</span>, <span class="fl">0.1</span>)</span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="co">###################################################################################################</span></span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="co">#&#39; fit &lt;- buildGaussianProcess(x,y)</span></span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="co">#&#39; ## Print model parameters</span></span>
<span id="cb32-7"><a href="#cb32-7"></a><span class="co">#&#39; print(fit)</span></span>
<span id="cb32-8"><a href="#cb32-8"></a><span class="co">#&#39; ## Predict at new location</span></span>
<span id="cb32-9"><a href="#cb32-9"></a><span class="co">#&#39; xNew &lt;- matrix( c(-0.1, 0.1), ncol = 1)</span></span>
<span id="cb32-10"><a href="#cb32-10"></a><span class="co">#&#39; predict(fit, xNew)</span></span>
<span id="cb32-11"><a href="#cb32-11"></a><span class="co">#&#39; ## True value at location</span></span>
<span id="cb32-12"><a href="#cb32-12"></a><span class="co">#&#39; t(funSphere(xNew))</span></span>
<span id="cb32-13"><a href="#cb32-13"></a><span class="co">###################################################################################################</span></span>
<span id="cb32-14"><a href="#cb32-14"></a>d &lt;-<span class="st"> </span>g &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb32-15"><a href="#cb32-15"></a>con&lt;-<span class="kw">list</span>(<span class="dt">samp.size =</span> <span class="dv">100</span>,</span>
<span id="cb32-16"><a href="#cb32-16"></a>          <span class="dt">modelControl =</span> <span class="kw">list</span>(<span class="dt">modelInitialized =</span> <span class="ot">FALSE</span>))</span>
<span id="cb32-17"><a href="#cb32-17"></a>  con[<span class="kw">names</span>(control)] &lt;-<span class="st"> </span>control</span>
<span id="cb32-18"><a href="#cb32-18"></a>  control&lt;-con</span>
<span id="cb32-19"><a href="#cb32-19"></a>    </span>
<span id="cb32-20"><a href="#cb32-20"></a>  <span class="co">## Case 1: model is not initialized:</span></span>
<span id="cb32-21"><a href="#cb32-21"></a>  <span class="cf">if</span> (control<span class="op">$</span>modelControl<span class="op">$</span>modelInitialized <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>){</span>
<span id="cb32-22"><a href="#cb32-22"></a>  control<span class="op">$</span>x &lt;-<span class="st"> </span>x</span>
<span id="cb32-23"><a href="#cb32-23"></a>    control<span class="op">$</span>y &lt;-<span class="st"> </span>y</span>
<span id="cb32-24"><a href="#cb32-24"></a>    d &lt;-<span class="st"> </span>laGP<span class="op">::</span><span class="kw">darg</span>(<span class="ot">NULL</span>, x, <span class="dt">samp.size =</span> control<span class="op">$</span>samp.size)</span>
<span id="cb32-25"><a href="#cb32-25"></a>    g &lt;-<span class="st"> </span>laGP<span class="op">::</span><span class="kw">garg</span>(<span class="kw">list</span>(<span class="dt">mle =</span> <span class="ot">TRUE</span>), y)</span>
<span id="cb32-26"><a href="#cb32-26"></a>    fit &lt;-<span class="st"> </span>laGP<span class="op">::</span><span class="kw">newGPsep</span>(x, y, <span class="dt">d =</span> d<span class="op">$</span>start, </span>
<span id="cb32-27"><a href="#cb32-27"></a>                     <span class="dt">g =</span> g<span class="op">$</span>start, <span class="dt">dK =</span> <span class="ot">TRUE</span>)</span>
<span id="cb32-28"><a href="#cb32-28"></a>    laGP<span class="op">::</span><span class="kw">jmleGPsep</span>(fit, </span>
<span id="cb32-29"><a href="#cb32-29"></a>                  <span class="dt">drange =</span> <span class="kw">c</span>(d<span class="op">$</span>min, d<span class="op">$</span>max), </span>
<span id="cb32-30"><a href="#cb32-30"></a>                  <span class="dt">grange =</span> <span class="kw">c</span>(g<span class="op">$</span>min, g<span class="op">$</span>max), </span>
<span id="cb32-31"><a href="#cb32-31"></a>                  <span class="dt">dab =</span> d<span class="op">$</span>ab, </span>
<span id="cb32-32"><a href="#cb32-32"></a>                  <span class="dt">gab =</span> g<span class="op">$</span>ab)</span>
<span id="cb32-33"><a href="#cb32-33"></a>    control<span class="op">$</span>fit &lt;-<span class="st"> </span>fit  </span>
<span id="cb32-34"><a href="#cb32-34"></a>    control<span class="op">$</span>d &lt;-<span class="st"> </span>d</span>
<span id="cb32-35"><a href="#cb32-35"></a>    control<span class="op">$</span>g &lt;-<span class="st"> </span>g</span>
<span id="cb32-36"><a href="#cb32-36"></a>    control<span class="op">$</span>pNames &lt;-<span class="st"> </span><span class="kw">colnames</span>(x)</span>
<span id="cb32-37"><a href="#cb32-37"></a>    control<span class="op">$</span>yName &lt;-<span class="st"> &quot;y&quot;</span></span>
<span id="cb32-38"><a href="#cb32-38"></a>    <span class="kw">class</span>(control) &lt;-<span class="st"> &quot;spotGaussianProcessModel&quot;</span></span>
<span id="cb32-39"><a href="#cb32-39"></a>  } </span>
<span id="cb32-40"><a href="#cb32-40"></a>  </span>
<span id="cb32-41"><a href="#cb32-41"></a>  control<span class="op">$</span>modelControl<span class="op">$</span>modelInitialized &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb32-42"><a href="#cb32-42"></a>  </span>
<span id="cb32-43"><a href="#cb32-43"></a>  xNew &lt;-<span class="st"> </span><span class="kw">matrix</span>( <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="dt">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb32-44"><a href="#cb32-44"></a>  </span>
<span id="cb32-45"><a href="#cb32-45"></a>  control<span class="op">$</span>xNewActualSize &lt;-<span class="st"> </span><span class="kw">nrow</span>(xNew)</span>
<span id="cb32-46"><a href="#cb32-46"></a>  x &lt;-<span class="st"> </span><span class="kw">rbind</span>(x, xNew)</span>
<span id="cb32-47"><a href="#cb32-47"></a>  y &lt;-<span class="st"> </span><span class="kw">funSphere</span>(x)  <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(N<span class="op">+</span>control<span class="op">$</span>xNewActualSize, <span class="dv">0</span>, <span class="fl">0.1</span>)</span>
<span id="cb32-48"><a href="#cb32-48"></a>    <span class="co">## Case 2: model is already initialized:</span></span>
<span id="cb32-49"><a href="#cb32-49"></a>      n &lt;-<span class="st"> </span><span class="kw">nrow</span>(x)</span>
<span id="cb32-50"><a href="#cb32-50"></a>      indices &lt;-<span class="st"> </span>(n <span class="op">-</span><span class="st"> </span>control<span class="op">$</span>xNewActualSize <span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>n</span>
<span id="cb32-51"><a href="#cb32-51"></a>      xnew &lt;-<span class="st"> </span>x[indices, , drop =<span class="st"> </span><span class="ot">FALSE</span>]</span>
<span id="cb32-52"><a href="#cb32-52"></a>      ynew &lt;-<span class="st"> </span>y[indices, ,drop =<span class="st"> </span><span class="ot">FALSE</span>]</span>
<span id="cb32-53"><a href="#cb32-53"></a>      laGP<span class="op">::</span><span class="kw">updateGPsep</span>(control<span class="op">$</span>fit, xnew, ynew)</span>
<span id="cb32-54"><a href="#cb32-54"></a>      laGP<span class="op">::</span><span class="kw">jmleGPsep</span>(control<span class="op">$</span>fit, </span>
<span id="cb32-55"><a href="#cb32-55"></a>                      <span class="dt">drange =</span> <span class="kw">c</span>(control<span class="op">$</span>d<span class="op">$</span>min, control<span class="op">$</span>d<span class="op">$</span>max), </span>
<span id="cb32-56"><a href="#cb32-56"></a>                      <span class="dt">grange =</span> <span class="kw">c</span>(control<span class="op">$</span>g<span class="op">$</span>min, control<span class="op">$</span>g<span class="op">$</span>max), </span>
<span id="cb32-57"><a href="#cb32-57"></a>                      <span class="dt">dab =</span> control<span class="op">$</span>d<span class="op">$</span>ab, </span>
<span id="cb32-58"><a href="#cb32-58"></a>                      <span class="dt">gab =</span> control<span class="op">$</span>g<span class="op">$</span>ab)</span>
<span id="cb32-59"><a href="#cb32-59"></a><span class="co">## prediction:</span></span>
<span id="cb32-60"><a href="#cb32-60"></a></span>
<span id="cb32-61"><a href="#cb32-61"></a>xNew &lt;-<span class="st"> </span><span class="kw">matrix</span>( <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="dt">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb32-62"><a href="#cb32-62"></a><span class="kw">predGPsep</span>(control<span class="op">$</span>fit, <span class="dt">XX =</span> xNew, <span class="dt">lite =</span> <span class="ot">TRUE</span>)</span>
<span id="cb32-63"><a href="#cb32-63"></a></span>
<span id="cb32-64"><a href="#cb32-64"></a>newdata &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(xNew)</span>
<span id="cb32-65"><a href="#cb32-65"></a><span class="kw">predict</span>(control<span class="op">$</span>fit, xNew)      </span>
<span id="cb32-66"><a href="#cb32-66"></a>      </span>
<span id="cb32-67"><a href="#cb32-67"></a>predict.spotGaussianProcessModel&lt;-<span class="cf">function</span>(object, newdata, ...){</span>
<span id="cb32-68"><a href="#cb32-68"></a>    newdata &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(newdata)</span>
<span id="cb32-69"><a href="#cb32-69"></a>  <span class="cf">if</span>(<span class="op">!</span><span class="kw">all</span>(<span class="kw">colnames</span>(newdata) <span class="op">%in%</span><span class="st"> </span>object<span class="op">$</span>pNames))</span>
<span id="cb32-70"><a href="#cb32-70"></a>    <span class="kw">colnames</span>(newdata) &lt;-<span class="st"> </span>object<span class="op">$</span>pNames</span>
<span id="cb32-71"><a href="#cb32-71"></a>  </span>
<span id="cb32-72"><a href="#cb32-72"></a>  <span class="kw">predGPsep</span>(object, <span class="dt">XX =</span> newdata, <span class="dt">lite =</span> <span class="ot">TRUE</span>)</span>
<span id="cb32-73"><a href="#cb32-73"></a>  </span>
<span id="cb32-74"><a href="#cb32-74"></a>  <span class="co"># seqVec &lt;- Vectorize(seq.default, vectorize.args = c(&quot;from&quot;, &quot;to&quot;))</span></span>
<span id="cb32-75"><a href="#cb32-75"></a>  <span class="co"># XX &lt;- matrix( seqVec(from = xmin, to = xmax, length.out = n), ncol = dim(x)[2])</span></span>
<span id="cb32-76"><a href="#cb32-76"></a>  <span class="co"># res &lt;- laGP::aGP(object$x, </span></span>
<span id="cb32-77"><a href="#cb32-77"></a>  <span class="co">#            object$y, </span></span>
<span id="cb32-78"><a href="#cb32-78"></a>  <span class="co">#            newdata,</span></span>
<span id="cb32-79"><a href="#cb32-79"></a>  <span class="co">#            end = 10,</span></span>
<span id="cb32-80"><a href="#cb32-80"></a>  <span class="co">#            d = object$d, </span></span>
<span id="cb32-81"><a href="#cb32-81"></a>  <span class="co">#            g = object$g, </span></span>
<span id="cb32-82"><a href="#cb32-82"></a>  <span class="co">#            verb = 0)</span></span>
<span id="cb32-83"><a href="#cb32-83"></a>  <span class="co"># plot(df$y ~ df[,2] , cex = 0.5, main = &quot;branin data&quot;)</span></span>
<span id="cb32-84"><a href="#cb32-84"></a>  <span class="co"># lines(XX[,1], motogp.p$mean, lwd = 2)</span></span>
<span id="cb32-85"><a href="#cb32-85"></a>  <span class="co"># q1 &lt;- qnorm(0.05, mean = motogp.p$mean, sd = sqrt(motogp.p$s2))</span></span>
<span id="cb32-86"><a href="#cb32-86"></a>  <span class="co"># q2 &lt;- qnorm(0.95, mean = motogp.p$mean, sd = sqrt(motogp.p$s2))</span></span>
<span id="cb32-87"><a href="#cb32-87"></a>  <span class="co"># lines(XX[,1], q1, lty = 2, lwd = 2)</span></span>
<span id="cb32-88"><a href="#cb32-88"></a>  <span class="co"># lines(XX[,1], q2, lty = 2, lwd = 2)</span></span>
<span id="cb32-89"><a href="#cb32-89"></a>  <span class="co"># lines(XX[,1], motoagp$mean, col = 2, lwd = 2)</span></span>
<span id="cb32-90"><a href="#cb32-90"></a>  <span class="co"># q1 &lt;- qnorm(0.05, mean = motoagp$mean, sd = sqrt(motoagp$var))</span></span>
<span id="cb32-91"><a href="#cb32-91"></a>  <span class="co"># q2 &lt;- qnorm(0.95, mean = motoagp$mean, sd = sqrt(motoagp$var))</span></span>
<span id="cb32-92"><a href="#cb32-92"></a>  <span class="co"># lines(XX[,1], q1, lty = 2, col = 2, lwd = 2)</span></span>
<span id="cb32-93"><a href="#cb32-93"></a>  <span class="co"># lines(XX[,1], q2, lty = 2, col = 2, lwd = 2)</span></span>
<span id="cb32-94"><a href="#cb32-94"></a>  <span class="kw">list</span>(<span class="dt">y =</span> res<span class="op">$</span>mean)</span>
<span id="cb32-95"><a href="#cb32-95"></a>}</span>
<span id="cb32-96"><a href="#cb32-96"></a></span>
<span id="cb32-97"><a href="#cb32-97"></a>            </span>
<span id="cb32-98"><a href="#cb32-98"></a>      </span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>X &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi,<span class="dt">length =</span> <span class="dv">6</span>), <span class="dt">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="kw">str</span>(X)</span></code></pre></div>
<ul>
<li>Build a Gaussian process C-side object based on the X-Z data and parameters provided, and augment those objects with new data</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>Z &lt;-<span class="st"> </span><span class="kw">sin</span>(X)</span>
<span id="cb34-2"><a href="#cb34-2"></a>gp &lt;-<span class="st"> </span><span class="kw">newGP</span>(X, Z, <span class="dv">2</span>, <span class="fl">1e-6</span>, <span class="dt">dK =</span> <span class="ot">TRUE</span>)</span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="kw">str</span>(gp)</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">mleGP</span>(gp, <span class="dt">tmax=</span><span class="dv">20</span>)</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>XX &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">499</span>), <span class="dt">ncol =</span> <span class="kw">ncol</span>(X))</span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="kw">str</span>(XX)</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>p &lt;-<span class="st"> </span><span class="kw">predGP</span>(gp, XX)</span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="kw">str</span>(p)</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="kw">library</span>(<span class="st">&quot;mvtnorm&quot;</span>)</span>
<span id="cb38-2"><a href="#cb38-2"></a>N &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb38-3"><a href="#cb38-3"></a>ZZ &lt;-<span class="st"> </span><span class="kw">rmvt</span>(N, p<span class="op">$</span>Sigma, p<span class="op">$</span>df)</span>
<span id="cb38-4"><a href="#cb38-4"></a>ZZ &lt;-<span class="st"> </span>ZZ <span class="op">+</span><span class="st"> </span><span class="kw">t</span>(<span class="kw">matrix</span>(<span class="kw">rep</span>(p<span class="op">$</span>mean, N), <span class="dt">ncol =</span> N))</span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="kw">str</span>(ZZ)</span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>{<span class="kw">matplot</span>(XX, <span class="kw">t</span>(ZZ), <span class="dt">col =</span> <span class="st">&quot;gray&quot;</span>, <span class="dt">lwd =</span> <span class="fl">0.5</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb39-2"><a href="#cb39-2"></a>    <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;simple sinusoidal example&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;x&quot;</span>, </span>
<span id="cb39-3"><a href="#cb39-3"></a>    <span class="dt">ylab =</span> <span class="st">&quot;Y(x) | thetahat&quot;</span>)</span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="kw">points</span>(X, Z, <span class="dt">pch =</span> <span class="dv">19</span>)}</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">by =</span> <span class="fl">0.02</span>)</span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="kw">str</span>(x)</span>
<span id="cb40-3"><a href="#cb40-3"></a>X &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">expand.grid</span>(x, x))</span>
<span id="cb40-4"><a href="#cb40-4"></a><span class="kw">str</span>(X)</span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>N &lt;-<span class="st"> </span><span class="kw">nrow</span>(X)</span>
<span id="cb41-2"><a href="#cb41-2"></a>f2d &lt;-<span class="st"> </span><span class="cf">function</span>(x)</span>
<span id="cb41-3"><a href="#cb41-3"></a>  {</span>
<span id="cb41-4"><a href="#cb41-4"></a>    g &lt;-<span class="st"> </span><span class="cf">function</span>(z)</span>
<span id="cb41-5"><a href="#cb41-5"></a>      <span class="kw">return</span>(<span class="kw">exp</span>( <span class="op">-</span><span class="st"> </span>(z <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>( <span class="fl">-0.8</span> <span class="op">*</span><span class="st"> </span>(z <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span>) </span>
<span id="cb41-6"><a href="#cb41-6"></a>        <span class="op">-</span><span class="st"> </span><span class="fl">0.05</span> <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(<span class="dv">8</span> <span class="op">*</span><span class="st"> </span>(z <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span>)))</span>
<span id="cb41-7"><a href="#cb41-7"></a>    <span class="op">-</span><span class="kw">g</span>(x[,<span class="dv">1</span>]) <span class="op">*</span><span class="st"> </span><span class="kw">g</span>(x[,<span class="dv">2</span>])</span>
<span id="cb41-8"><a href="#cb41-8"></a>  }</span>
<span id="cb41-9"><a href="#cb41-9"></a>Y &lt;-<span class="st"> </span><span class="kw">f2d</span>(X)</span>
<span id="cb41-10"><a href="#cb41-10"></a><span class="kw">str</span>(Y)</span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>Xref &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="op">-</span><span class="fl">1.725</span>, <span class="fl">1.725</span>), <span class="dt">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb42-2"><a href="#cb42-2"></a>p.mspe &lt;-<span class="st"> </span><span class="kw">laGP</span>(Xref, <span class="dv">6</span>, <span class="dv">50</span>, X, Y, <span class="dt">d =</span> <span class="fl">0.1</span>, <span class="dt">method=</span><span class="st">&quot;mspe&quot;</span>)</span>
<span id="cb42-3"><a href="#cb42-3"></a><span class="kw">str</span>(p.mspe)</span></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>p.alc &lt;-<span class="st"> </span><span class="kw">laGP</span>(Xref, <span class="dv">6</span>, <span class="dv">50</span>, X, Y, <span class="dt">d =</span> <span class="fl">0.1</span>, <span class="dt">method=</span><span class="st">&quot;alc&quot;</span>)</span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="kw">str</span>(p.alc)</span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>Xi &lt;-<span class="st"> </span><span class="kw">rbind</span>(X[p.mspe<span class="op">$</span>Xi, ], X[p.alc<span class="op">$</span>Xi, ])</span>
<span id="cb44-2"><a href="#cb44-2"></a>{</span>
<span id="cb44-3"><a href="#cb44-3"></a><span class="kw">plot</span>(X[p.mspe<span class="op">$</span>Xi, ], <span class="dt">xlab =</span> <span class="st">&quot;x1&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;x2&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb44-4"><a href="#cb44-4"></a>  <span class="dt">main =</span> <span class="st">&quot;comparing local designs&quot;</span>, <span class="dt">xlim =</span> <span class="kw">range</span>(Xi[ ,<span class="dv">1</span>]), </span>
<span id="cb44-5"><a href="#cb44-5"></a>  <span class="dt">ylim =</span> <span class="kw">range</span>(Xi[ ,<span class="dv">2</span>]))</span>
<span id="cb44-6"><a href="#cb44-6"></a><span class="kw">text</span>(X[p.mspe<span class="op">$</span>Xi, ], <span class="dt">labels =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(p.mspe<span class="op">$</span>Xi), <span class="dt">cex =</span> <span class="fl">0.7</span>)</span>
<span id="cb44-7"><a href="#cb44-7"></a><span class="kw">text</span>(X[p.alc<span class="op">$</span>Xi, ], <span class="dt">labels =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(p.alc<span class="op">$</span>Xi), <span class="dt">cex =</span> <span class="fl">0.7</span>, <span class="dt">col =</span> <span class="dv">2</span>)</span>
<span id="cb44-8"><a href="#cb44-8"></a><span class="kw">points</span>(Xref[<span class="dv">1</span>], Xref[<span class="dv">2</span>], <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span><span class="dv">3</span>)</span>
<span id="cb44-9"><a href="#cb44-9"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;mspe&quot;</span>, <span class="st">&quot;alc&quot;</span>), <span class="dt">text.col =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb44-10"><a href="#cb44-10"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>p &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(p.mspe<span class="op">$</span>mean, p.mspe<span class="op">$</span>s2, p.mspe<span class="op">$</span>df),</span>
<span id="cb45-2"><a href="#cb45-2"></a>  <span class="kw">c</span>(p.alc<span class="op">$</span>mean, p.alc<span class="op">$</span>s2, p.alc<span class="op">$</span>df))</span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="kw">colnames</span>(p) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;mean&quot;</span>, <span class="st">&quot;s2&quot;</span>, <span class="st">&quot;df&quot;</span>)</span>
<span id="cb45-4"><a href="#cb45-4"></a><span class="kw">rownames</span>(p) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;mspe&quot;</span>, <span class="st">&quot;alc&quot;</span>)</span>
<span id="cb45-5"><a href="#cb45-5"></a>p</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>p.mspe<span class="op">$</span>mle</span>
<span id="cb46-2"><a href="#cb46-2"></a>p.alc<span class="op">$</span>mle</span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="kw">c</span>(p.mspe<span class="op">$</span>time, p.alc<span class="op">$</span>time)</span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>xx &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="fl">1.97</span>, <span class="fl">1.95</span>, <span class="dt">by =</span> <span class="fl">0.04</span>)</span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="kw">str</span>(xx)</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>XX &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">expand.grid</span>(xx, xx))</span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="kw">str</span>(XX)</span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>YY &lt;-<span class="st"> </span><span class="kw">f2d</span>(XX)</span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="kw">str</span>(YY)</span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>nth &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">Sys.getenv</span>(<span class="st">&quot;OMP_NUM_THREADS&quot;</span>))</span>
<span id="cb51-2"><a href="#cb51-2"></a>nth &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="cf">if</span>(<span class="kw">is.na</span>(nth)) nth &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb51-4"><a href="#cb51-4"></a><span class="kw">print</span>(nth)</span>
<span id="cb51-5"><a href="#cb51-5"></a>P.alc &lt;-<span class="st"> </span><span class="kw">aGP</span>(X, Y, XX, <span class="dt">omp.threads =</span> nth, <span class="dt">verb =</span> <span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="kw">persp</span>(xx, xx, <span class="op">-</span><span class="kw">matrix</span>(P.alc<span class="op">$</span>mean, <span class="dt">ncol =</span> <span class="kw">length</span>(xx)), <span class="dt">phi=</span><span class="dv">45</span>, <span class="dt">theta=</span><span class="dv">45</span>,</span>
<span id="cb52-2"><a href="#cb52-2"></a>      <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;x1&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;x2&quot;</span>, <span class="dt">zlab =</span> <span class="st">&quot;yhat(x)&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>med &lt;-<span class="st"> </span><span class="fl">0.51</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>zs &lt;-<span class="st"> </span>XX[, <span class="dv">2</span>] <span class="op">==</span><span class="st"> </span>med</span>
<span id="cb53-3"><a href="#cb53-3"></a>sv &lt;-<span class="st"> </span><span class="kw">sqrt</span>(P.alc<span class="op">$</span>var[zs])</span>
<span id="cb53-4"><a href="#cb53-4"></a>r &lt;-<span class="st"> </span><span class="kw">range</span>(<span class="kw">c</span>(<span class="op">-</span>P.alc<span class="op">$</span>mean[zs] <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>sv, <span class="op">-</span>P.alc<span class="op">$</span>mean[zs] <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>sv))</span>
<span id="cb53-5"><a href="#cb53-5"></a><span class="kw">plot</span>(XX[zs,<span class="dv">1</span>], <span class="op">-</span>P.alc<span class="op">$</span>mean[zs], <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">ylim =</span> r, <span class="dt">xlab =</span> <span class="st">&quot;x1&quot;</span>,</span>
<span id="cb53-6"><a href="#cb53-6"></a>     <span class="dt">ylab =</span> <span class="st">&quot;predicted &amp; true response&quot;</span>, <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb53-7"><a href="#cb53-7"></a>     <span class="dt">main =</span> <span class="st">&quot;slice through surface&quot;</span>)</span>
<span id="cb53-8"><a href="#cb53-8"></a><span class="kw">lines</span>(XX[zs, <span class="dv">1</span>], <span class="op">-</span>P.alc<span class="op">$</span>mean[zs] <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>sv, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb53-9"><a href="#cb53-9"></a><span class="kw">lines</span>(XX[zs, <span class="dv">1</span>], <span class="op">-</span>P.alc<span class="op">$</span>mean[zs] <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>sv, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb53-10"><a href="#cb53-10"></a><span class="kw">lines</span>(XX[zs, <span class="dv">1</span>], YY[zs], <span class="dt">col =</span> <span class="dv">3</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">3</span>)</span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>diff &lt;-<span class="st"> </span>P.alc<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>YY</span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="kw">plot</span>(XX[zs,<span class="dv">1</span>], diff[zs], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb54-3"><a href="#cb54-3"></a>     <span class="dt">main =</span> <span class="st">&quot;systematic bias in prediction&quot;</span>, </span>
<span id="cb54-4"><a href="#cb54-4"></a>     <span class="dt">xlab =</span> <span class="st">&quot;x1&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;y(x) - yhat(x)&quot;</span>, <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="kw">plot</span>(XX[zs,<span class="dv">1</span>], P.alc<span class="op">$</span>mle<span class="op">$</span>d[zs], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, </span>
<span id="cb55-2"><a href="#cb55-2"></a>     <span class="dt">main =</span> <span class="st">&quot;spatially varying lengthscale&quot;</span>, </span>
<span id="cb55-3"><a href="#cb55-3"></a>     <span class="dt">xlab =</span> <span class="st">&quot;x1&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;thetahat(x)&quot;</span>, <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">y =</span> <span class="kw">log</span>(P.alc<span class="op">$</span>mle<span class="op">$</span>d), XX)</span>
<span id="cb56-2"><a href="#cb56-2"></a>lo &lt;-<span class="st"> </span><span class="kw">loess</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> df, <span class="dt">span =</span> <span class="fl">0.01</span>)</span>
<span id="cb56-3"><a href="#cb56-3"></a><span class="kw">lines</span>(XX[zs,<span class="dv">1</span>], <span class="kw">exp</span>(lo<span class="op">$</span>fitted)[zs], <span class="dt">col=</span><span class="dv">2</span>, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb56-4"><a href="#cb56-4"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="st">&quot;loess smoothed&quot;</span>, <span class="dt">col=</span><span class="dv">2</span>, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>P.alc2 &lt;-<span class="st"> </span><span class="kw">aGP</span>(X, Y, XX, <span class="dt">d =</span> <span class="kw">exp</span>(lo<span class="op">$</span>fitted), <span class="dt">omp.threads =</span> nth, <span class="dt">verb =</span> <span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>rmse &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">alc =</span> <span class="kw">sqrt</span>(<span class="kw">mean</span>((P.alc<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>YY)<span class="op">^</span><span class="dv">2</span>)), </span>
<span id="cb58-2"><a href="#cb58-2"></a>  <span class="dt">alc2 =</span> <span class="kw">sqrt</span>(<span class="kw">mean</span>((P.alc2<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>YY)<span class="op">^</span><span class="dv">2</span>)))</span>
<span id="cb58-3"><a href="#cb58-3"></a>rmse</span></code></pre></div>
</div>
<div id="computational-techniques-for-speeding-up-local-search" class="section level2">
<h2>Computational techniques for speeding up local search</h2>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>p.alcray &lt;-<span class="st"> </span><span class="kw">laGP</span>(Xref, <span class="dv">6</span>, <span class="dv">50</span>, X, Y, <span class="dt">d =</span> <span class="fl">0.1</span>, <span class="dt">method =</span> <span class="st">&quot;alcray&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="kw">plot</span>(X[p.alc<span class="op">$</span>Xi,], <span class="dt">xlab =</span> <span class="st">&quot;x1&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;x2&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb60-2"><a href="#cb60-2"></a>  <span class="dt">main=</span><span class="st">&quot;comparing local designs&quot;</span>, <span class="dt">xlim =</span> <span class="kw">range</span>(Xi[ ,<span class="dv">1</span>]), </span>
<span id="cb60-3"><a href="#cb60-3"></a>  <span class="dt">ylim =</span> <span class="kw">range</span>(Xi[ ,<span class="dv">2</span>]))</span>
<span id="cb60-4"><a href="#cb60-4"></a><span class="kw">text</span>(X[p.alc<span class="op">$</span>Xi,], <span class="dt">labels =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(p.alc<span class="op">$</span>Xi), <span class="dt">cex =</span> <span class="fl">0.7</span>, <span class="dt">col =</span> <span class="dv">2</span>)</span>
<span id="cb60-5"><a href="#cb60-5"></a><span class="kw">text</span>(X[p.alcray<span class="op">$</span>Xi,], <span class="dt">labels=</span><span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(p.mspe<span class="op">$</span>Xi), <span class="dt">cex=</span><span class="fl">0.7</span>, <span class="dt">col =</span> <span class="dv">3</span>)</span>
<span id="cb60-6"><a href="#cb60-6"></a><span class="kw">points</span>(Xref[<span class="dv">1</span>], Xref[<span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> <span class="dv">3</span>)</span>
<span id="cb60-7"><a href="#cb60-7"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;alc&quot;</span>, <span class="st">&quot;alcray&quot;</span>), <span class="dt">text.col =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>p.alcray<span class="op">$</span>time</span></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>p &lt;-<span class="st"> </span><span class="kw">rbind</span>(p, <span class="kw">c</span>(p.alcray<span class="op">$</span>mean, p.alcray<span class="op">$</span>s2, p.alcray<span class="op">$</span>df))</span>
<span id="cb62-2"><a href="#cb62-2"></a><span class="kw">rownames</span>(p)[<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;alcray&quot;</span>)</span>
<span id="cb62-3"><a href="#cb62-3"></a>p</span></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>P.alcray &lt;-<span class="st"> </span><span class="kw">aGP</span>(X, Y, XX, <span class="dt">method =</span> <span class="st">&quot;alcray&quot;</span>, <span class="dt">omp.threads =</span> nth, <span class="dt">verb =</span> <span class="dv">0</span>)</span>
<span id="cb63-2"><a href="#cb63-2"></a>dfray &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">y =</span> <span class="kw">log</span>(P.alcray<span class="op">$</span>mle<span class="op">$</span>d), XX)</span>
<span id="cb63-3"><a href="#cb63-3"></a>loray &lt;-<span class="st"> </span><span class="kw">loess</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> dfray, <span class="dt">span =</span> <span class="fl">0.01</span>)</span>
<span id="cb63-4"><a href="#cb63-4"></a>P.alcray2 &lt;-<span class="st"> </span><span class="kw">aGP</span>(X, Y, XX, <span class="dt">method =</span> <span class="st">&quot;alcray&quot;</span>, <span class="dt">d =</span> <span class="kw">exp</span>(loray<span class="op">$</span>fitted), </span>
<span id="cb63-5"><a href="#cb63-5"></a>  <span class="dt">omp.threads =</span> nth, <span class="dt">verb =</span> <span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="kw">c</span>(P.alcray<span class="op">$</span>time, P.alcray2<span class="op">$</span>time)</span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>rmse &lt;-<span class="st"> </span><span class="kw">cbind</span>(rmse, </span>
<span id="cb65-2"><a href="#cb65-2"></a>  <span class="kw">data.frame</span>(<span class="dt">alcray=</span><span class="kw">sqrt</span>(<span class="kw">mean</span>((P.alcray<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>YY)<span class="op">^</span><span class="dv">2</span>)), </span>
<span id="cb65-3"><a href="#cb65-3"></a>    <span class="dt">alcray2=</span><span class="kw">sqrt</span>(<span class="kw">mean</span>((P.alcray2<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>YY)<span class="op">^</span><span class="dv">2</span>))))</span>
<span id="cb65-4"><a href="#cb65-4"></a>rmse</span></code></pre></div>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<div id="borehole-data" class="section level3">
<h3>Borehole data</h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a>N &lt;-<span class="st"> </span><span class="dv">100000</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>Npred &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb66-3"><a href="#cb66-3"></a>dim &lt;-<span class="st"> </span><span class="dv">8</span></span>
<span id="cb66-4"><a href="#cb66-4"></a><span class="kw">library</span>(<span class="st">&quot;lhs&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a>T &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb67-2"><a href="#cb67-2"></a>nas &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, T)</span>
<span id="cb67-3"><a href="#cb67-3"></a>times &lt;-<span class="st"> </span>rmse &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">mspe =</span> nas, <span class="dt">mspe2 =</span> nas, </span>
<span id="cb67-4"><a href="#cb67-4"></a>  <span class="dt">alc.nomle =</span> nas, <span class="dt">alc =</span> nas, <span class="dt">alc2 =</span> nas,</span>
<span id="cb67-5"><a href="#cb67-5"></a>  <span class="dt">nn.nomle =</span> nas, <span class="dt">nn=</span>nas, <span class="dt">big.nn.nomle =</span> nas, <span class="dt">big.nn =</span> nas,</span>
<span id="cb67-6"><a href="#cb67-6"></a>  <span class="dt">big.alcray =</span> nas, <span class="dt">big.alcray2 =</span> nas)</span></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>borehole &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb68-2"><a href="#cb68-2"></a>  rw &lt;-<span class="st"> </span>x[<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>(<span class="fl">0.15</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.05</span>) <span class="op">+</span><span class="st"> </span><span class="fl">0.05</span></span>
<span id="cb68-3"><a href="#cb68-3"></a>  r &lt;-<span class="st">  </span>x[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>(<span class="dv">50000</span> <span class="op">-</span><span class="st"> </span><span class="dv">100</span>) <span class="op">+</span><span class="st"> </span><span class="dv">100</span></span>
<span id="cb68-4"><a href="#cb68-4"></a>  Tu &lt;-<span class="st"> </span>x[<span class="dv">3</span>] <span class="op">*</span><span class="st"> </span>(<span class="dv">115600</span> <span class="op">-</span><span class="st"> </span><span class="dv">63070</span>) <span class="op">+</span><span class="st"> </span><span class="dv">63070</span></span>
<span id="cb68-5"><a href="#cb68-5"></a>  Hu &lt;-<span class="st"> </span>x[<span class="dv">4</span>] <span class="op">*</span><span class="st"> </span>(<span class="dv">1110</span> <span class="op">-</span><span class="st"> </span><span class="dv">990</span>) <span class="op">+</span><span class="st"> </span><span class="dv">990</span></span>
<span id="cb68-6"><a href="#cb68-6"></a>  Tl &lt;-<span class="st"> </span>x[<span class="dv">5</span>] <span class="op">*</span><span class="st"> </span>(<span class="dv">116</span> <span class="op">-</span><span class="st"> </span><span class="fl">63.1</span>) <span class="op">+</span><span class="st"> </span><span class="fl">63.1</span></span>
<span id="cb68-7"><a href="#cb68-7"></a>  Hl &lt;-<span class="st"> </span>x[<span class="dv">6</span>] <span class="op">*</span><span class="st"> </span>(<span class="dv">820</span> <span class="op">-</span><span class="st"> </span><span class="dv">700</span>) <span class="op">+</span><span class="st"> </span><span class="dv">700</span></span>
<span id="cb68-8"><a href="#cb68-8"></a>  L &lt;-<span class="st">  </span>x[<span class="dv">7</span>] <span class="op">*</span><span class="st"> </span>(<span class="dv">1680</span> <span class="op">-</span><span class="st"> </span><span class="dv">1120</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1120</span></span>
<span id="cb68-9"><a href="#cb68-9"></a>  Kw &lt;-<span class="st"> </span>x[<span class="dv">8</span>] <span class="op">*</span><span class="st"> </span>(<span class="dv">12045</span> <span class="op">-</span><span class="st"> </span><span class="dv">9855</span>) <span class="op">+</span><span class="st"> </span><span class="dv">9855</span></span>
<span id="cb68-10"><a href="#cb68-10"></a>  m1 &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi <span class="op">*</span><span class="st"> </span>Tu <span class="op">*</span><span class="st"> </span>(Hu <span class="op">-</span><span class="st"> </span>Hl)</span>
<span id="cb68-11"><a href="#cb68-11"></a>  m2 &lt;-<span class="st"> </span><span class="kw">log</span>(r <span class="op">/</span><span class="st"> </span>rw)</span>
<span id="cb68-12"><a href="#cb68-12"></a>  m3 &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>L <span class="op">*</span><span class="st"> </span>Tu <span class="op">/</span><span class="st"> </span>(m2 <span class="op">*</span><span class="st"> </span>rw<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>Kw) <span class="op">+</span><span class="st"> </span>Tu <span class="op">/</span><span class="st"> </span>Tl</span>
<span id="cb68-13"><a href="#cb68-13"></a>  <span class="kw">return</span>(m1<span class="op">/</span>m2<span class="op">/</span>m3)</span>
<span id="cb68-14"><a href="#cb68-14"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>T) {</span>
<span id="cb69-2"><a href="#cb69-2"></a>  x &lt;-<span class="st"> </span><span class="kw">randomLHS</span>(N <span class="op">+</span><span class="st"> </span>Npred, dim)</span>
<span id="cb69-3"><a href="#cb69-3"></a>  y &lt;-<span class="st"> </span><span class="kw">apply</span>(x, <span class="dv">1</span>, borehole)</span>
<span id="cb69-4"><a href="#cb69-4"></a>  ypred<span class="fl">.0</span> &lt;-<span class="st"> </span>y[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span>N)]; y &lt;-<span class="st"> </span>y[<span class="dv">1</span><span class="op">:</span>N]</span>
<span id="cb69-5"><a href="#cb69-5"></a>  xpred &lt;-<span class="st"> </span>x[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span>N),]; x &lt;-<span class="st"> </span>x[<span class="dv">1</span><span class="op">:</span>N,]</span>
<span id="cb69-6"><a href="#cb69-6"></a></span>
<span id="cb69-7"><a href="#cb69-7"></a>  <span class="kw">formals</span>(aGP)[<span class="kw">c</span>(<span class="st">&quot;omp.threads&quot;</span>, <span class="st">&quot;verb&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">c</span>(nth, <span class="dv">0</span>)</span>
<span id="cb69-8"><a href="#cb69-8"></a>  <span class="kw">formals</span>(aGP)[<span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;XX&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(x, y, xpred)</span>
<span id="cb69-9"><a href="#cb69-9"></a></span>
<span id="cb69-10"><a href="#cb69-10"></a>  out1&lt;-<span class="st"> </span><span class="kw">aGP</span>(<span class="dt">d=</span><span class="kw">list</span>(<span class="dt">mle =</span> <span class="ot">FALSE</span>, <span class="dt">start =</span> <span class="fl">0.7</span>))</span>
<span id="cb69-11"><a href="#cb69-11"></a>  rmse<span class="op">$</span>alc.nomle[t] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((out1<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>ypred<span class="fl">.0</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb69-12"><a href="#cb69-12"></a>  times<span class="op">$</span>alc.nomle[t] &lt;-<span class="st"> </span>out1<span class="op">$</span>time</span>
<span id="cb69-13"><a href="#cb69-13"></a>  </span>
<span id="cb69-14"><a href="#cb69-14"></a>  out2 &lt;-<span class="st"> </span><span class="kw">aGP</span>(<span class="dt">d =</span> <span class="kw">list</span>(<span class="dt">max =</span> <span class="dv">20</span>))</span>
<span id="cb69-15"><a href="#cb69-15"></a>  rmse<span class="op">$</span>alc[t] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((out2<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>ypred<span class="fl">.0</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb69-16"><a href="#cb69-16"></a>  times<span class="op">$</span>alc[t] &lt;-<span class="st"> </span>out2<span class="op">$</span>time</span>
<span id="cb69-17"><a href="#cb69-17"></a>  </span>
<span id="cb69-18"><a href="#cb69-18"></a>  out3 &lt;-<span class="st"> </span><span class="kw">aGP</span>(<span class="dt">d =</span> <span class="kw">list</span>(<span class="dt">start =</span> out2<span class="op">$</span>mle<span class="op">$</span>d, <span class="dt">max =</span> <span class="dv">20</span>))</span>
<span id="cb69-19"><a href="#cb69-19"></a>  rmse<span class="op">$</span>alc2[t] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((out3<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>ypred<span class="fl">.0</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb69-20"><a href="#cb69-20"></a>  times<span class="op">$</span>alc2[t] &lt;-<span class="st"> </span>out3<span class="op">$</span>time</span>
<span id="cb69-21"><a href="#cb69-21"></a></span>
<span id="cb69-22"><a href="#cb69-22"></a>  out4 &lt;-<span class="st"> </span><span class="kw">aGP</span>(<span class="dt">d =</span> <span class="kw">list</span>(<span class="dt">max =</span> <span class="dv">20</span>), <span class="dt">method=</span><span class="st">&quot;alcray&quot;</span>)</span>
<span id="cb69-23"><a href="#cb69-23"></a>  rmse<span class="op">$</span>alcray[t] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((out4<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>ypred<span class="fl">.0</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb69-24"><a href="#cb69-24"></a>  times<span class="op">$</span>alcray[t] &lt;-<span class="st"> </span>out4<span class="op">$</span>time</span>
<span id="cb69-25"><a href="#cb69-25"></a>  </span>
<span id="cb69-26"><a href="#cb69-26"></a>  out5 &lt;-<span class="st"> </span><span class="kw">aGP</span>(<span class="dt">d =</span> <span class="kw">list</span>(<span class="dt">start =</span> out4<span class="op">$</span>mle<span class="op">$</span>d, <span class="dt">max =</span> <span class="dv">20</span>), <span class="dt">method=</span><span class="st">&quot;alcray&quot;</span>)</span>
<span id="cb69-27"><a href="#cb69-27"></a>  rmse<span class="op">$</span>alcray2[t] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((out5<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>ypred<span class="fl">.0</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb69-28"><a href="#cb69-28"></a>  times<span class="op">$</span>alcray2[t] &lt;-<span class="st"> </span>out5<span class="op">$</span>time</span>
<span id="cb69-29"><a href="#cb69-29"></a></span>
<span id="cb69-30"><a href="#cb69-30"></a>  out6&lt;-<span class="st"> </span><span class="kw">aGP</span>(<span class="dt">d =</span> <span class="kw">list</span>(<span class="dt">max =</span> <span class="dv">20</span>), <span class="dt">method=</span><span class="st">&quot;mspe&quot;</span>)</span>
<span id="cb69-31"><a href="#cb69-31"></a>  rmse<span class="op">$</span>mspe[t] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((out6<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>ypred<span class="fl">.0</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb69-32"><a href="#cb69-32"></a>  times<span class="op">$</span>mspe[t] &lt;-<span class="st"> </span>out6<span class="op">$</span>time</span>
<span id="cb69-33"><a href="#cb69-33"></a>  </span>
<span id="cb69-34"><a href="#cb69-34"></a>  out7 &lt;-<span class="st"> </span><span class="kw">aGP</span>(<span class="dt">d =</span> <span class="kw">list</span>(<span class="dt">start =</span> out6<span class="op">$</span>mle<span class="op">$</span>d, <span class="dt">max =</span> <span class="dv">20</span>), <span class="dt">method=</span><span class="st">&quot;mspe&quot;</span>)</span>
<span id="cb69-35"><a href="#cb69-35"></a>  rmse<span class="op">$</span>mspe2[t] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((out7<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>ypred<span class="fl">.0</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb69-36"><a href="#cb69-36"></a>  times<span class="op">$</span>mspe2[t] &lt;-<span class="st"> </span>out7<span class="op">$</span>time</span>
<span id="cb69-37"><a href="#cb69-37"></a></span>
<span id="cb69-38"><a href="#cb69-38"></a>  out8 &lt;-<span class="st"> </span><span class="kw">aGP</span>(<span class="dt">d =</span> <span class="kw">list</span>(<span class="dt">mle =</span> <span class="ot">FALSE</span>, <span class="dt">start =</span> <span class="fl">0.7</span>), <span class="dt">method =</span> <span class="st">&quot;nn&quot;</span>)</span>
<span id="cb69-39"><a href="#cb69-39"></a>  rmse<span class="op">$</span>nn.nomle[t] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((out8<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>ypred<span class="fl">.0</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb69-40"><a href="#cb69-40"></a>  times<span class="op">$</span>nn.nomle[t] &lt;-<span class="st"> </span>out8<span class="op">$</span>time</span>
<span id="cb69-41"><a href="#cb69-41"></a></span>
<span id="cb69-42"><a href="#cb69-42"></a>  out9 &lt;-<span class="st"> </span><span class="kw">aGP</span>(<span class="dt">end =</span> <span class="dv">200</span>, <span class="dt">d =</span> <span class="kw">list</span>(<span class="dt">mle =</span> <span class="ot">FALSE</span>), <span class="dt">method =</span> <span class="st">&quot;nn&quot;</span>)</span>
<span id="cb69-43"><a href="#cb69-43"></a>  rmse<span class="op">$</span>big.nn.nomle[t] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((out9<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>ypred<span class="fl">.0</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb69-44"><a href="#cb69-44"></a>  times<span class="op">$</span>big.nn.nomle[t] &lt;-<span class="st"> </span>out9<span class="op">$</span>time</span>
<span id="cb69-45"><a href="#cb69-45"></a></span>
<span id="cb69-46"><a href="#cb69-46"></a>  out10 &lt;-<span class="st"> </span><span class="kw">aGP</span>(<span class="dt">d =</span> <span class="kw">list</span>(<span class="dt">max =</span> <span class="dv">20</span>), <span class="dt">method =</span> <span class="st">&quot;nn&quot;</span>)</span>
<span id="cb69-47"><a href="#cb69-47"></a>  rmse<span class="op">$</span>nn[t] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((out10<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>ypred<span class="fl">.0</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb69-48"><a href="#cb69-48"></a>  times<span class="op">$</span>nn[t] &lt;-<span class="st"> </span>out10<span class="op">$</span>time</span>
<span id="cb69-49"><a href="#cb69-49"></a></span>
<span id="cb69-50"><a href="#cb69-50"></a>  out11 &lt;-<span class="st"> </span><span class="kw">aGP</span>(<span class="dt">end =</span> <span class="dv">200</span>, <span class="dt">d =</span> <span class="kw">list</span>(<span class="dt">max =</span> <span class="dv">20</span>), <span class="dt">method=</span><span class="st">&quot;nn&quot;</span>)</span>
<span id="cb69-51"><a href="#cb69-51"></a>  rmse<span class="op">$</span>big.nn[t] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((out11<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>ypred<span class="fl">.0</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb69-52"><a href="#cb69-52"></a>  times<span class="op">$</span>big.nn[t] &lt;-<span class="st"> </span>out11<span class="op">$</span>time</span>
<span id="cb69-53"><a href="#cb69-53"></a></span>
<span id="cb69-54"><a href="#cb69-54"></a>  out12 &lt;-<span class="st"> </span><span class="kw">aGP</span>(<span class="dt">end =</span> <span class="dv">200</span>, <span class="dt">d =</span> <span class="kw">list</span>(<span class="dt">max =</span> <span class="dv">20</span>), <span class="dt">method=</span><span class="st">&quot;alcray&quot;</span>)</span>
<span id="cb69-55"><a href="#cb69-55"></a>  rmse<span class="op">$</span>big.alcray[t] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((out12<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>ypred<span class="fl">.0</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb69-56"><a href="#cb69-56"></a>  times<span class="op">$</span>big.alcray[t] &lt;-<span class="st"> </span>out12<span class="op">$</span>time</span>
<span id="cb69-57"><a href="#cb69-57"></a>  </span>
<span id="cb69-58"><a href="#cb69-58"></a>  out13 &lt;-<span class="st"> </span><span class="kw">aGP</span>(<span class="dt">end =</span> <span class="dv">200</span>, <span class="dt">d =</span> <span class="kw">list</span>(<span class="dt">start =</span> out12<span class="op">$</span>mle<span class="op">$</span>d, <span class="dt">max =</span> <span class="dv">20</span>), </span>
<span id="cb69-59"><a href="#cb69-59"></a>    <span class="dt">method=</span><span class="st">&quot;alcray&quot;</span>)</span>
<span id="cb69-60"><a href="#cb69-60"></a>  rmse<span class="op">$</span>big.alcray2[t] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((out13<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>ypred<span class="fl">.0</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb69-61"><a href="#cb69-61"></a>  times<span class="op">$</span>big.alcray2[t] &lt;-<span class="st"> </span>out13 <span class="op">$</span>time</span>
<span id="cb69-62"><a href="#cb69-62"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a>timev &lt;-<span class="st"> </span><span class="kw">apply</span>(times, <span class="dv">2</span>, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb70-2"><a href="#cb70-2"></a>rmsev &lt;-<span class="st"> </span><span class="kw">apply</span>(rmse, <span class="dv">2</span>, mean)</span>
<span id="cb70-3"><a href="#cb70-3"></a>tab &lt;-<span class="st"> </span><span class="kw">cbind</span>(timev, rmsev)</span>
<span id="cb70-4"><a href="#cb70-4"></a>o &lt;-<span class="st"> </span><span class="kw">order</span>(rmsev, <span class="dt">decreasing =</span> <span class="ot">FALSE</span>)</span>
<span id="cb70-5"><a href="#cb70-5"></a>tt &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">length</span>(rmsev))</span>
<span id="cb70-6"><a href="#cb70-6"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">length</span>(o)<span class="op">-</span><span class="dv">1</span>)) {</span>
<span id="cb70-7"><a href="#cb70-7"></a>  tto &lt;-<span class="st"> </span><span class="kw">t.test</span>(rmse[ ,o[i]], rmse[ ,o[i<span class="op">+</span><span class="dv">1</span>]], <span class="dt">alternative =</span> <span class="st">&quot;less&quot;</span>, </span>
<span id="cb70-8"><a href="#cb70-8"></a>    <span class="dt">paired =</span> <span class="ot">TRUE</span>)</span>
<span id="cb70-9"><a href="#cb70-9"></a>  tt[o[i]] &lt;-<span class="st"> </span>tto<span class="op">$</span>p.value</span>
<span id="cb70-10"><a href="#cb70-10"></a>}</span>
<span id="cb70-11"><a href="#cb70-11"></a>tab &lt;-<span class="st"> </span><span class="kw">cbind</span>(tab, <span class="kw">data.frame</span>(tt))</span>
<span id="cb70-12"><a href="#cb70-12"></a>tab[o, ]</span></code></pre></div>
</div>
</div>
<div id="challenging-globallocal-isotropy" class="section level2">
<h2>Challenging global/local isotropy</h2>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a>thats &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> T, <span class="dt">ncol =</span> dim)</span>
<span id="cb71-2"><a href="#cb71-2"></a>its &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, T)</span>
<span id="cb71-3"><a href="#cb71-3"></a>n &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb71-4"><a href="#cb71-4"></a></span>
<span id="cb71-5"><a href="#cb71-5"></a>g2 &lt;-<span class="st"> </span><span class="kw">garg</span>(<span class="kw">list</span>(<span class="dt">mle =</span> <span class="ot">TRUE</span>), y)</span>
<span id="cb71-6"><a href="#cb71-6"></a>d2 &lt;-<span class="st"> </span><span class="kw">darg</span>(<span class="kw">list</span>(<span class="dt">mle =</span> <span class="ot">TRUE</span>, <span class="dt">max =</span> <span class="dv">100</span>), x)</span>
<span id="cb71-7"><a href="#cb71-7"></a></span>
<span id="cb71-8"><a href="#cb71-8"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>T) {</span>
<span id="cb71-9"><a href="#cb71-9"></a>  </span>
<span id="cb71-10"><a href="#cb71-10"></a>  subs &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>N, n, <span class="dt">replace =</span> <span class="ot">FALSE</span>)</span>
<span id="cb71-11"><a href="#cb71-11"></a></span>
<span id="cb71-12"><a href="#cb71-12"></a>  gpsepi &lt;-<span class="st"> </span><span class="kw">newGPsep</span>(x[subs, ], y[subs], <span class="kw">rep</span>(d2<span class="op">$</span>start, dim), <span class="dt">g =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">1000</span>, </span>
<span id="cb71-13"><a href="#cb71-13"></a>    <span class="dt">dK =</span> <span class="ot">TRUE</span>)</span>
<span id="cb71-14"><a href="#cb71-14"></a>  that &lt;-<span class="st"> </span><span class="kw">mleGPsep</span>(gpsepi, <span class="dt">param =</span> <span class="st">&quot;d&quot;</span>, <span class="dt">tmin =</span> d2<span class="op">$</span>min, <span class="dt">tmax =</span> d2<span class="op">$</span>max, </span>
<span id="cb71-15"><a href="#cb71-15"></a>    <span class="dt">ab =</span> d2<span class="op">$</span>ab, <span class="dt">maxit =</span> <span class="dv">200</span>)</span>
<span id="cb71-16"><a href="#cb71-16"></a>  thats[t,] &lt;-<span class="st"> </span>that<span class="op">$</span>d</span>
<span id="cb71-17"><a href="#cb71-17"></a>  its[t] &lt;-<span class="st"> </span>that<span class="op">$</span>its</span>
<span id="cb71-18"><a href="#cb71-18"></a></span>
<span id="cb71-19"><a href="#cb71-19"></a>  <span class="kw">deleteGPsep</span>(gpsepi)</span>
<span id="cb71-20"><a href="#cb71-20"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="kw">boxplot</span>(thats, <span class="dt">main =</span> <span class="st">&quot;distribution of thetas&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;input&quot;</span>, </span>
<span id="cb72-2"><a href="#cb72-2"></a>  <span class="dt">ylab =</span> <span class="st">&quot;theta&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a>scales &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">apply</span>(thats, <span class="dv">2</span>, median))</span>
<span id="cb73-2"><a href="#cb73-2"></a>xs &lt;-<span class="st"> </span>x; xpreds &lt;-<span class="st"> </span>xpred</span>
<span id="cb73-3"><a href="#cb73-3"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(xs)) {</span>
<span id="cb73-4"><a href="#cb73-4"></a>  xs[,j] &lt;-<span class="st"> </span>xs[,j] <span class="op">/</span><span class="st"> </span>scales[j]</span>
<span id="cb73-5"><a href="#cb73-5"></a>  xpreds[,j] &lt;-<span class="st"> </span>xpreds[,j] <span class="op">/</span><span class="st"> </span>scales[j]</span>
<span id="cb73-6"><a href="#cb73-6"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>out14 &lt;-<span class="st"> </span><span class="kw">aGP</span>(xs, y, xpreds, <span class="dt">d=</span><span class="kw">list</span>(<span class="dt">start=</span><span class="dv">1</span>, <span class="dt">max=</span><span class="dv">20</span>), <span class="dt">method=</span><span class="st">&quot;alcray&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="kw">sqrt</span>(<span class="kw">mean</span>((out14<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span>ypred<span class="fl">.0</span>)<span class="op">^</span><span class="dv">2</span>))</span></code></pre></div>
</div>
<div id="motorcycle-data" class="section level2">
<h2>Motorcycle data</h2>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="kw">library</span>(<span class="st">&quot;MASS&quot;</span>)</span>
<span id="cb76-2"><a href="#cb76-2"></a>d &lt;-<span class="st"> </span><span class="kw">darg</span>(<span class="ot">NULL</span>, mcycle[, <span class="dv">1</span>, <span class="dt">drop =</span> <span class="ot">FALSE</span>])</span>
<span id="cb76-3"><a href="#cb76-3"></a>g &lt;-<span class="st"> </span><span class="kw">garg</span>(<span class="kw">list</span>(<span class="dt">mle =</span> <span class="ot">TRUE</span>), mcycle[,<span class="dv">2</span>])</span>
<span id="cb76-4"><a href="#cb76-4"></a>motogp &lt;-<span class="st"> </span><span class="kw">newGP</span>(mcycle[ , <span class="dv">1</span>, <span class="dt">drop=</span><span class="ot">FALSE</span>], mcycle[ ,<span class="dv">2</span>], <span class="dt">d =</span> d<span class="op">$</span>start, </span>
<span id="cb76-5"><a href="#cb76-5"></a>  <span class="dt">g =</span> g<span class="op">$</span>start, <span class="dt">dK =</span> <span class="ot">TRUE</span>)</span>
<span id="cb76-6"><a href="#cb76-6"></a><span class="kw">jmleGP</span>(motogp, <span class="dt">drange =</span> <span class="kw">c</span>(d<span class="op">$</span>min, d<span class="op">$</span>max), <span class="dt">grange =</span> <span class="kw">c</span>(d<span class="op">$</span>min, d<span class="op">$</span>max), </span>
<span id="cb76-7"><a href="#cb76-7"></a>  <span class="dt">dab =</span> d<span class="op">$</span>ab, <span class="dt">gab =</span> g<span class="op">$</span>ab)</span></code></pre></div>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a>XX &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">seq</span>(<span class="kw">min</span>(mcycle[ ,<span class="dv">1</span>]), <span class="kw">max</span>(mcycle[ ,<span class="dv">1</span>]), <span class="dt">length =</span> <span class="dv">100</span>), </span>
<span id="cb77-2"><a href="#cb77-2"></a>  <span class="dt">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb77-3"><a href="#cb77-3"></a>motogp.p &lt;-<span class="st"> </span><span class="kw">predGP</span>(motogp, <span class="dt">XX =</span> XX, <span class="dt">lite =</span> <span class="ot">TRUE</span>)</span>
<span id="cb77-4"><a href="#cb77-4"></a>motoagp &lt;-<span class="st"> </span><span class="kw">aGP</span>(mcycle[ , <span class="dv">1</span>, <span class="dt">drop=</span><span class="ot">FALSE</span>], mcycle[,<span class="dv">2</span>], XX, <span class="dt">end =</span> <span class="dv">30</span>, </span>
<span id="cb77-5"><a href="#cb77-5"></a>  <span class="dt">d =</span> d, <span class="dt">g =</span> g, <span class="dt">verb =</span> <span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="kw">plot</span>(mcycle, <span class="dt">cex =</span> <span class="fl">0.5</span>, <span class="dt">main =</span> <span class="st">&quot;motorcycle data&quot;</span>)</span>
<span id="cb78-2"><a href="#cb78-2"></a><span class="kw">lines</span>(XX, motogp.p<span class="op">$</span>mean, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb78-3"><a href="#cb78-3"></a>q1 &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.05</span>, <span class="dt">mean =</span> motogp.p<span class="op">$</span>mean, <span class="dt">sd =</span> <span class="kw">sqrt</span>(motogp.p<span class="op">$</span>s2))</span>
<span id="cb78-4"><a href="#cb78-4"></a>q2 &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.95</span>, <span class="dt">mean =</span> motogp.p<span class="op">$</span>mean, <span class="dt">sd =</span> <span class="kw">sqrt</span>(motogp.p<span class="op">$</span>s2))</span>
<span id="cb78-5"><a href="#cb78-5"></a><span class="kw">lines</span>(XX, q1, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb78-6"><a href="#cb78-6"></a><span class="kw">lines</span>(XX, q2, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb78-7"><a href="#cb78-7"></a><span class="kw">lines</span>(XX, motoagp<span class="op">$</span>mean, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb78-8"><a href="#cb78-8"></a>q1 &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.05</span>, <span class="dt">mean =</span> motoagp<span class="op">$</span>mean, <span class="dt">sd =</span> <span class="kw">sqrt</span>(motoagp<span class="op">$</span>var))</span>
<span id="cb78-9"><a href="#cb78-9"></a>q2 &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.95</span>, <span class="dt">mean =</span> motoagp<span class="op">$</span>mean, <span class="dt">sd =</span> <span class="kw">sqrt</span>(motoagp<span class="op">$</span>var))</span>
<span id="cb78-10"><a href="#cb78-10"></a><span class="kw">lines</span>(XX, q1, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb78-11"><a href="#cb78-11"></a><span class="kw">lines</span>(XX, q2, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a>X &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(mcycle[ ,<span class="dv">1</span>], <span class="dv">10</span>), <span class="dt">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb79-2"><a href="#cb79-2"></a>X &lt;-<span class="st"> </span>X <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">nrow</span>(X), <span class="dt">sd =</span> <span class="dv">1</span>)</span>
<span id="cb79-3"><a href="#cb79-3"></a>Z &lt;-<span class="st"> </span><span class="kw">rep</span>(mcycle[ ,<span class="dv">2</span>], <span class="dv">10</span>)</span>
<span id="cb79-4"><a href="#cb79-4"></a>motoagp2 &lt;-<span class="st"> </span><span class="kw">aGP</span>(X, Z, XX, <span class="dt">end =</span> <span class="dv">30</span>, <span class="dt">d =</span> d, <span class="dt">g =</span> g, <span class="dt">verb =</span> <span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="kw">plot</span>(X, Z, <span class="dt">main =</span> <span class="st">&quot;simulating a larger data setup&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;times&quot;</span>, </span>
<span id="cb80-2"><a href="#cb80-2"></a>  <span class="dt">ylab =</span> <span class="st">&quot;accel&quot;</span>)</span>
<span id="cb80-3"><a href="#cb80-3"></a><span class="kw">lines</span>(XX, motoagp2<span class="op">$</span>mean, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb80-4"><a href="#cb80-4"></a>q1 &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.05</span>, <span class="dt">mean =</span> motoagp2<span class="op">$</span>mean, <span class="dt">sd =</span> <span class="kw">sqrt</span>(motoagp2<span class="op">$</span>var))</span>
<span id="cb80-5"><a href="#cb80-5"></a>q2 &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.95</span>, <span class="dt">mean =</span> motoagp2<span class="op">$</span>mean, <span class="dt">sd =</span> <span class="kw">sqrt</span>(motoagp2<span class="op">$</span>var))</span>
<span id="cb80-6"><a href="#cb80-6"></a><span class="kw">lines</span>(XX, q1, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb80-7"><a href="#cb80-7"></a><span class="kw">lines</span>(XX, q2, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>** Calibration *** An illustrative example</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>M &lt;-<span class="st"> </span><span class="cf">function</span>(x,u) </span>
<span id="cb81-2"><a href="#cb81-2"></a>  {</span>
<span id="cb81-3"><a href="#cb81-3"></a>    x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(x)</span>
<span id="cb81-4"><a href="#cb81-4"></a>    u &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(u)</span>
<span id="cb81-5"><a href="#cb81-5"></a>    out &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x[,<span class="dv">2</span>]))) </span>
<span id="cb81-6"><a href="#cb81-6"></a>    out &lt;-<span class="st"> </span>out <span class="op">*</span><span class="st"> </span>(<span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>u[,<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>x[,<span class="dv">1</span>]<span class="op">^</span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span><span class="dv">1900</span> <span class="op">*</span><span class="st"> </span>x[ ,<span class="dv">1</span>]<span class="op">^</span><span class="dv">2</span> </span>
<span id="cb81-7"><a href="#cb81-7"></a>      <span class="op">+</span><span class="st"> </span><span class="dv">2092</span> <span class="op">*</span><span class="st"> </span>x[ ,<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">60</span>) </span>
<span id="cb81-8"><a href="#cb81-8"></a>    out &lt;-<span class="st"> </span>out <span class="op">/</span><span class="st"> </span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>u[,<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>x[,<span class="dv">1</span>]<span class="op">^</span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span><span class="dv">500</span> <span class="op">*</span><span class="st"> </span>x[ ,<span class="dv">1</span>]<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span>x[ ,<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">20</span>)  </span>
<span id="cb81-9"><a href="#cb81-9"></a>    <span class="kw">return</span>(out)</span>
<span id="cb81-10"><a href="#cb81-10"></a>  }</span></code></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a>bias &lt;-<span class="st"> </span><span class="cf">function</span>(x) </span>
<span id="cb82-2"><a href="#cb82-2"></a>  {</span>
<span id="cb82-3"><a href="#cb82-3"></a>    x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(x)   </span>
<span id="cb82-4"><a href="#cb82-4"></a>    out &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>x[ ,<span class="dv">1</span>]<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span>x[ ,<span class="dv">2</span>]<span class="op">^</span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span>(<span class="dv">50</span> <span class="op">*</span><span class="st"> </span>x[ ,<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>x[ ,<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span><span class="dv">10</span>)</span>
<span id="cb82-5"><a href="#cb82-5"></a>    <span class="kw">return</span>(out)</span>
<span id="cb82-6"><a href="#cb82-6"></a>  }</span></code></pre></div>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="kw">library</span>(<span class="st">&quot;tgp&quot;</span>)</span>
<span id="cb83-2"><a href="#cb83-2"></a>rect &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dv">4</span>), <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="dv">2</span>)</span>
<span id="cb83-3"><a href="#cb83-3"></a>ny &lt;-<span class="st"> </span><span class="dv">50</span></span>
<span id="cb83-4"><a href="#cb83-4"></a>X &lt;-<span class="st"> </span><span class="kw">lhs</span>(ny, rect[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,] )</span>
<span id="cb83-5"><a href="#cb83-5"></a>u &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>)</span>
<span id="cb83-6"><a href="#cb83-6"></a>Zu &lt;-<span class="st"> </span><span class="kw">M</span>(X, <span class="kw">matrix</span>(u, <span class="dt">nrow =</span> <span class="dv">1</span>)) </span>
<span id="cb83-7"><a href="#cb83-7"></a>sd &lt;-<span class="st"> </span><span class="fl">0.5</span></span>
<span id="cb83-8"><a href="#cb83-8"></a>reps &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb83-9"><a href="#cb83-9"></a>Y &lt;-<span class="st"> </span><span class="kw">rep</span>(Zu, reps) <span class="op">+</span><span class="st"> </span><span class="kw">rep</span>(<span class="kw">bias</span>(X), reps) <span class="op">+</span><span class="st"> </span></span>
<span id="cb83-10"><a href="#cb83-10"></a><span class="st">  </span><span class="kw">rnorm</span>(reps <span class="op">*</span><span class="st"> </span><span class="kw">length</span>(Zu), <span class="dt">sd =</span> sd) </span></code></pre></div>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>nz &lt;-<span class="st"> </span><span class="dv">10000</span></span>
<span id="cb84-2"><a href="#cb84-2"></a>XU &lt;-<span class="st"> </span><span class="kw">lhs</span>(nz, rect)</span>
<span id="cb84-3"><a href="#cb84-3"></a>XU2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow=</span><span class="dv">10</span> <span class="op">*</span><span class="st"> </span>ny, <span class="dt">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb84-4"><a href="#cb84-4"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) {</span>
<span id="cb84-5"><a href="#cb84-5"></a>  I &lt;-<span class="st"> </span>((i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>ny <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)<span class="op">:</span>(ny <span class="op">*</span><span class="st"> </span>i)</span>
<span id="cb84-6"><a href="#cb84-6"></a>  XU2[I, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>] &lt;-<span class="st"> </span>X</span>
<span id="cb84-7"><a href="#cb84-7"></a>}</span>
<span id="cb84-8"><a href="#cb84-8"></a>XU2[ ,<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>] &lt;-<span class="st"> </span><span class="kw">lhs</span>(<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>ny, rect[<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>, ])</span>
<span id="cb84-9"><a href="#cb84-9"></a>XU &lt;-<span class="st"> </span><span class="kw">rbind</span>(XU, XU2)</span>
<span id="cb84-10"><a href="#cb84-10"></a>Z &lt;-<span class="st"> </span><span class="kw">M</span>(XU[ ,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], XU[ ,<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>])</span></code></pre></div>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a>bias.est &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb85-2"><a href="#cb85-2"></a>methods &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;alc&quot;</span>, <span class="dv">2</span>)</span>
<span id="cb85-3"><a href="#cb85-3"></a>da &lt;-<span class="st"> </span>d &lt;-<span class="st"> </span><span class="kw">darg</span>(<span class="ot">NULL</span>, XU)</span>
<span id="cb85-4"><a href="#cb85-4"></a>g &lt;-<span class="st"> </span><span class="kw">garg</span>(<span class="kw">list</span>(<span class="dt">mle =</span> <span class="ot">TRUE</span>), Y) </span></code></pre></div>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>beta.prior &lt;-<span class="st"> </span><span class="cf">function</span>(u, <span class="dt">a =</span> <span class="dv">2</span>, <span class="dt">b =</span> <span class="dv">2</span>, <span class="dt">log =</span> <span class="ot">TRUE</span>)</span>
<span id="cb86-2"><a href="#cb86-2"></a>{</span>
<span id="cb86-3"><a href="#cb86-3"></a>  <span class="cf">if</span>(<span class="kw">length</span>(a) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) a &lt;-<span class="st"> </span><span class="kw">rep</span>(a, <span class="kw">length</span>(u))</span>
<span id="cb86-4"><a href="#cb86-4"></a>  <span class="cf">else</span> <span class="cf">if</span>(<span class="kw">length</span>(a) <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(u)) <span class="kw">stop</span>(<span class="st">&quot;length(a) must be 1 or length(u)&quot;</span>)</span>
<span id="cb86-5"><a href="#cb86-5"></a>  <span class="cf">if</span>(<span class="kw">length</span>(b) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) b &lt;-<span class="st"> </span><span class="kw">rep</span>(b, <span class="kw">length</span>(u))</span>
<span id="cb86-6"><a href="#cb86-6"></a>  <span class="cf">else</span> <span class="cf">if</span>(<span class="kw">length</span>(b) <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(u)) <span class="kw">stop</span>(<span class="st">&quot;length(b) must be 1 or length(u)&quot;</span>)</span>
<span id="cb86-7"><a href="#cb86-7"></a>  <span class="cf">if</span>(log) <span class="kw">return</span>(<span class="kw">sum</span>(<span class="kw">dbeta</span>(u, a, b, <span class="dt">log=</span><span class="ot">TRUE</span>)))</span>
<span id="cb86-8"><a href="#cb86-8"></a>  <span class="cf">else</span> <span class="kw">return</span>(<span class="kw">prod</span>(<span class="kw">dbeta</span>(u, a, b, <span class="dt">log=</span><span class="ot">FALSE</span>)))</span>
<span id="cb86-9"><a href="#cb86-9"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a>initsize &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">*</span><span class="kw">ncol</span>(X)</span>
<span id="cb87-2"><a href="#cb87-2"></a>imesh &lt;-<span class="st"> </span><span class="fl">0.1</span></span>
<span id="cb87-3"><a href="#cb87-3"></a>irect &lt;-<span class="st"> </span>rect[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,]</span>
<span id="cb87-4"><a href="#cb87-4"></a>irect[,<span class="dv">1</span>] &lt;-<span class="st"> </span>irect[,<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>imesh<span class="op">/</span><span class="dv">2</span></span>
<span id="cb87-5"><a href="#cb87-5"></a>irect[,<span class="dv">2</span>] &lt;-<span class="st"> </span>irect[,<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>imesh<span class="op">/</span><span class="dv">2</span></span>
<span id="cb87-6"><a href="#cb87-6"></a>uinit.cand &lt;-<span class="st"> </span><span class="kw">lhs</span>(<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>initsize, irect) </span>
<span id="cb87-7"><a href="#cb87-7"></a>uinit &lt;-<span class="st"> </span><span class="kw">dopt.gp</span>(initsize, <span class="dt">Xcand =</span> <span class="kw">lhs</span>(<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>initsize, irect))<span class="op">$</span>XX</span>
<span id="cb87-8"><a href="#cb87-8"></a>llinit &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">nrow</span>(uinit))</span>
<span id="cb87-9"><a href="#cb87-9"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(uinit)) {</span>
<span id="cb87-10"><a href="#cb87-10"></a>  llinit[i] &lt;-<span class="st"> </span><span class="kw">fcalib</span>(uinit[i,], XU, Z, X, Y, da, d, g, beta.prior, </span>
<span id="cb87-11"><a href="#cb87-11"></a>                  methods, M, bias.est, nth, <span class="dt">verb =</span> <span class="dv">0</span>)</span>
<span id="cb87-12"><a href="#cb87-12"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="kw">library</span>(<span class="st">&quot;crs&quot;</span>)</span>
<span id="cb88-2"><a href="#cb88-2"></a>opts &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;MAX_BB_EVAL&quot;</span> =<span class="st"> </span><span class="dv">1000</span>, <span class="st">&quot;INITIAL_MESH_SIZE&quot;</span> =<span class="st"> </span>imesh, </span>
<span id="cb88-3"><a href="#cb88-3"></a>  <span class="st">&quot;MIN_POLL_SIZE&quot;</span> =<span class="st"> &quot;r0.001&quot;</span>, <span class="st">&quot;DISPLAY_DEGREE&quot;</span> =<span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a>its &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb89-2"><a href="#cb89-2"></a>o &lt;-<span class="st"> </span><span class="kw">order</span>(llinit)</span>
<span id="cb89-3"><a href="#cb89-3"></a>i &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb89-4"><a href="#cb89-4"></a>out &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb89-5"><a href="#cb89-5"></a><span class="cf">while</span>(its <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>) {</span>
<span id="cb89-6"><a href="#cb89-6"></a>  outi &lt;-<span class="st"> </span><span class="kw">snomadr</span>(fcalib, <span class="dv">2</span>, <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="dv">0</span>, <span class="dt">x0 =</span> uinit[o[i],],</span>
<span id="cb89-7"><a href="#cb89-7"></a>            <span class="dt">lb =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">ub =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">opts =</span> opts, <span class="dt">XU =</span> XU, </span>
<span id="cb89-8"><a href="#cb89-8"></a>            <span class="dt">Z =</span> Z, <span class="dt">X =</span> X, <span class="dt">Y =</span> Y, <span class="dt">da =</span> da, <span class="dt">d =</span> d, <span class="dt">g =</span> g, </span>
<span id="cb89-9"><a href="#cb89-9"></a>            <span class="dt">methods =</span> methods, <span class="dt">M =</span> M, <span class="dt">bias =</span> bias.est, </span>
<span id="cb89-10"><a href="#cb89-10"></a>            <span class="dt">omp.threads =</span> nth, <span class="dt">uprior =</span> beta.prior, </span>
<span id="cb89-11"><a href="#cb89-11"></a>            <span class="dt">save.global =</span> .GlobalEnv, <span class="dt">verb =</span> <span class="dv">0</span>)</span>
<span id="cb89-12"><a href="#cb89-12"></a>  its &lt;-<span class="st"> </span>its <span class="op">+</span><span class="st"> </span>outi<span class="op">$</span>iterations</span>
<span id="cb89-13"><a href="#cb89-13"></a>  <span class="cf">if</span>(<span class="kw">is.null</span>(out) <span class="op">||</span><span class="st"> </span>outi<span class="op">$</span>objective <span class="op">&lt;</span><span class="st"> </span>out<span class="op">$</span>objective) out &lt;-<span class="st"> </span>outi</span>
<span id="cb89-14"><a href="#cb89-14"></a>  i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>;</span>
<span id="cb89-15"><a href="#cb89-15"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a>Xp &lt;-<span class="st"> </span><span class="kw">rbind</span>(uinit, <span class="kw">as.matrix</span>(fcalib.save[ ,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]))</span>
<span id="cb90-2"><a href="#cb90-2"></a>Zp &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span>llinit, fcalib.save[ ,<span class="dv">3</span>])</span>
<span id="cb90-3"><a href="#cb90-3"></a>wi &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="op">!</span><span class="kw">is.finite</span>(Zp))</span>
<span id="cb90-4"><a href="#cb90-4"></a><span class="cf">if</span>(<span class="kw">length</span>(wi) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) { Xp &lt;-<span class="st"> </span>Xp[<span class="op">-</span>wi, ]; Zp &lt;-<span class="st"> </span>Zp[<span class="op">-</span>wi]}</span>
<span id="cb90-5"><a href="#cb90-5"></a>surf &lt;-<span class="st"> </span><span class="kw">interp</span>(Xp[ ,<span class="dv">1</span>], Xp[ ,<span class="dv">2</span>], Zp, <span class="dt">duplicate =</span> <span class="st">&quot;mean&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="kw">image</span>(surf, <span class="dt">xlab =</span> <span class="st">&quot;u1&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;u2&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;posterior surface&quot;</span>,</span>
<span id="cb91-2"><a href="#cb91-2"></a>  <span class="dt">col =</span> <span class="kw">heat.colors</span>(<span class="dv">128</span>), <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb91-3"><a href="#cb91-3"></a><span class="kw">points</span>(uinit)</span>
<span id="cb91-4"><a href="#cb91-4"></a><span class="kw">points</span>(fcalib.save[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">col =</span> <span class="dv">3</span>, <span class="dt">pch =</span> <span class="dv">18</span>)</span>
<span id="cb91-5"><a href="#cb91-5"></a>u.hat &lt;-<span class="st"> </span>outi<span class="op">$</span>solution</span>
<span id="cb91-6"><a href="#cb91-6"></a><span class="kw">points</span>(u.hat[<span class="dv">1</span>], u.hat[<span class="dv">2</span>], <span class="dt">col =</span> <span class="dv">4</span>, <span class="dt">pch =</span> <span class="dv">18</span>)</span>
<span id="cb91-7"><a href="#cb91-7"></a><span class="kw">abline</span>(<span class="dt">v =</span> u[<span class="dv">1</span>], <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb91-8"><a href="#cb91-8"></a><span class="kw">abline</span>(<span class="dt">h =</span> u[<span class="dv">2</span>], <span class="dt">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a>Xu &lt;-<span class="st"> </span><span class="kw">cbind</span>(X, <span class="kw">matrix</span>(<span class="kw">rep</span>(u, ny), <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span>
<span id="cb92-2"><a href="#cb92-2"></a>Mhat.u &lt;-<span class="st"> </span><span class="kw">aGP.seq</span>(XU, Z, Xu, da, methods, <span class="dt">ncalib =</span> <span class="dv">2</span>, <span class="dt">omp.threads =</span> nth, </span>
<span id="cb92-3"><a href="#cb92-3"></a>  <span class="dt">verb =</span> <span class="dv">0</span>)</span>
<span id="cb92-4"><a href="#cb92-4"></a>cmle.u &lt;-<span class="st"> </span><span class="kw">discrep.est</span>(X, Y, Mhat.u<span class="op">$</span>mean, d, g, bias.est, <span class="ot">FALSE</span>)</span>
<span id="cb92-5"><a href="#cb92-5"></a>cmle.u<span class="op">$</span>ll &lt;-<span class="st"> </span>cmle.u<span class="op">$</span>ll <span class="op">+</span><span class="st"> </span><span class="kw">beta.prior</span>(u)</span></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="kw">data.frame</span>(<span class="dt">u.hat =</span> <span class="op">-</span>outi<span class="op">$</span>objective, <span class="dt">u =</span> cmle.u<span class="op">$</span>ll)</span></code></pre></div>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a>nny &lt;-<span class="st"> </span><span class="dv">1000</span>  </span>
<span id="cb94-2"><a href="#cb94-2"></a>XX &lt;-<span class="st"> </span><span class="kw">lhs</span>(nny, rect[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,])</span>
<span id="cb94-3"><a href="#cb94-3"></a>ZZu &lt;-<span class="st"> </span><span class="kw">M</span>(XX, <span class="kw">matrix</span>(u, <span class="dt">nrow =</span> <span class="dv">1</span>)) </span>
<span id="cb94-4"><a href="#cb94-4"></a>YYtrue &lt;-<span class="st"> </span>ZZu <span class="op">+</span><span class="st"> </span><span class="kw">bias</span>(XX) </span></code></pre></div>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a>XXu &lt;-<span class="st"> </span><span class="kw">cbind</span>(XX, <span class="kw">matrix</span>(<span class="kw">rep</span>(u, nny), <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span>
<span id="cb95-2"><a href="#cb95-2"></a>Mhat.oos.u &lt;-<span class="st"> </span><span class="kw">aGP.seq</span>(XU, Z, XXu, da, methods, <span class="dt">ncalib =</span> <span class="dv">2</span>, </span>
<span id="cb95-3"><a href="#cb95-3"></a>  <span class="dt">omp.threads =</span> nth, <span class="dt">verb =</span> <span class="dv">0</span>)</span>
<span id="cb95-4"><a href="#cb95-4"></a>YYm.pred.u &lt;-<span class="st"> </span><span class="kw">predGP</span>(cmle.u<span class="op">$</span>gp, XX)</span>
<span id="cb95-5"><a href="#cb95-5"></a>YY.pred.u &lt;-<span class="st"> </span>YYm.pred.u<span class="op">$</span>mean <span class="op">+</span><span class="st"> </span>Mhat.oos.u<span class="op">$</span>mean</span>
<span id="cb95-6"><a href="#cb95-6"></a>rmse.u &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((YY.pred.u <span class="op">-</span><span class="st"> </span>YYtrue)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb95-7"><a href="#cb95-7"></a><span class="kw">deleteGP</span>(cmle.u<span class="op">$</span>gp)</span></code></pre></div>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a>Xu &lt;-<span class="st"> </span><span class="kw">cbind</span>(X, <span class="kw">matrix</span>(<span class="kw">rep</span>(u.hat, ny), <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span>
<span id="cb96-2"><a href="#cb96-2"></a>Mhat &lt;-<span class="st"> </span><span class="kw">aGP.seq</span>(XU, Z, Xu, da, methods, <span class="dt">ncalib =</span> <span class="dv">2</span>, <span class="dt">omp.threads =</span> nth, </span>
<span id="cb96-3"><a href="#cb96-3"></a>  <span class="dt">verb =</span> <span class="dv">0</span>)</span>
<span id="cb96-4"><a href="#cb96-4"></a>cmle &lt;-<span class="st"> </span><span class="kw">discrep.est</span>(X, Y, Mhat<span class="op">$</span>mean, d, g, bias.est, <span class="ot">FALSE</span>)</span>
<span id="cb96-5"><a href="#cb96-5"></a>cmle<span class="op">$</span>ll &lt;-<span class="st"> </span>cmle<span class="op">$</span>ll <span class="op">+</span><span class="st"> </span><span class="kw">beta.prior</span>(u.hat)</span></code></pre></div>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="kw">print</span>(<span class="kw">c</span>(cmle<span class="op">$</span>ll, <span class="op">-</span>outi<span class="op">$</span>objective))</span></code></pre></div>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a>XXu &lt;-<span class="st"> </span><span class="kw">cbind</span>(XX, <span class="kw">matrix</span>(<span class="kw">rep</span>(u.hat, nny), <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span>
<span id="cb98-2"><a href="#cb98-2"></a>Mhat.oos &lt;-<span class="st"> </span><span class="kw">aGP.seq</span>(XU, Z, XXu, da, methods, <span class="dt">ncalib =</span> <span class="dv">2</span>, </span>
<span id="cb98-3"><a href="#cb98-3"></a>  <span class="dt">omp.threads =</span> nth, <span class="dt">verb =</span> <span class="dv">0</span>)</span>
<span id="cb98-4"><a href="#cb98-4"></a>YYm.pred &lt;-<span class="st"> </span><span class="kw">predGP</span>(cmle<span class="op">$</span>gp, XX)</span>
<span id="cb98-5"><a href="#cb98-5"></a>YY.pred &lt;-<span class="st"> </span>YYm.pred<span class="op">$</span>mean <span class="op">+</span><span class="st"> </span>Mhat.oos<span class="op">$</span>mean</span>
<span id="cb98-6"><a href="#cb98-6"></a>rmse &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((YY.pred <span class="op">-</span><span class="st"> </span>YYtrue)<span class="op">^</span><span class="dv">2</span>))</span></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="kw">data.frame</span>(<span class="dt">u.hat =</span> rmse, <span class="dt">u =</span> rmse.u)</span></code></pre></div>
<p>** Ongoing development and extensions</p>
<p>The  package is under active development, and the corpus of code was developed with ease of extension in mind. The calibration application from Section  is a perfect example: simple functions tap into local GP emulators and full GP discrepancies alike, and are paired with existing direct optimizing subroutines from other packages for a powerful solution to large scale calibration problems that are becoming commonplace in the recent literature. As mentioned in Section , the implementation of separable modeling for local analysis is under active development and testing. Many of the associated subroutines (e.g., {laGPsep} and {aGPsep}) are available for use in the latest version of the package.</p>
<p>The library comprises roughly fifty  functions, although barely a fraction of those are elevated to the user’s namespace for use in a typical  session. Many of the inaccesible/undocumented functions have a purpose which, at this time, seem less directly useful outside their calling environment, but may eventually be promoted. Many higher level functions, like  and  which access  subroutines, have a development-analog ( and ) implementing similar (usually with identical output, our a superset of output) subroutines entirely in . These were used as stepping stones in the development of the  versions; however they remain relevant as a window into the inner-workings of the package and as a skeleton for curious users’ ambitions for new extensions. The local approximate GP methodology is, in a nutshell, just a judicious combination of established subroutines from the recent spatial statistics and computer experiments literature. We hope that exposing those combinations in well-organized code will spur others to take a similar tack in developing their own solutions in novel contexts.</p>
<p>One example involves deploying basic package functionality—only utilizing full (non local) GP subroutines—for solving blackbox optimization problems under constraints.  showed how the augmented Lagrangian (AL), an apparatus popular for solving similar constrained optimization problems in the recent literature , could be combined with the method of expected improvement  to solve a particular type of optimization where the objective was known (and in particular was linear), but where the constraints required (potentially expensive) simulation. Searching for an optimal valid setting of the inputs to the blackbox function could be substantially complicated by a difficult-to-map constraint satisfaction boundary. The package includes a demo [see ] showcasing a variation on one of the examples from . The problem therein involves modeling an objective and two constraints with GP predictors, together with an EI calculation on an AL predictive composite. The demo shows how the new, statistical, AL method outperforms the non-statistical analog.</p>

<p>Most of the work for this article was completed while the author was in the Booth School of Business at The University of Chicago. The author is grateful for partial support from National Science Foundation grant DMS-1521702.</p>


<p>In the bulk of this document, and in the core package routines (e.g., , and ) the treatment and default generation of initial values, regularization (priors), and bounding boxes, is largely hidden from the user. Some exceptions include places where it is desirable to have each instance of a repeated call, e.g., in a Monte Carlo experiment, share identical inferential conditions across subtly varying (randomly generated) data sets. In those cases,  and  generate values that control and limit the behaviors of the estimating algorithms for the lengthscale (<span class="math inline">\(\theta\)</span>/) and nugget (<span class="math inline">\(\eta\)</span>/), respectively. Although the package allows inference to proceed without regularization (true MLEs), and arbitrary starting values to be provided, generating sensible ones automatically is a key component in guaranteeing stable behavior out-of-the-box. In settings where potentially thousands of such calculations occur in parallel and without opportunity for individual scrutiny or intervention, such as via  [Section ], sensible defaults are essential.</p>
<p>The two methods  and , which are invoked by  and  unless overrides are provided, leverage crude input summary statistics. For example,  calculates squared distances between elements of the design matrix  to determine appropriate regularization. A bounding box for  is derived from the min and max distances, and a diffuse Gamma prior prescribed with  and  set so that the maximum squared distance lies at the position of the 95% quantile. Together these define the regularization of MLE estimates for , or equivalently depict (a search for) the maximum {} (MAP) value. We prefer the term MLE as the purpose of the prior is to guard against pathologies, rather than to interject information. The starting -value is chosen the 10% quantile of the calculated distances.</p>
<p>The  function makes similar calculations on the sum of squared residuals in  from , an exception being that by default the minimum nugget value is taken to be . When invoked by a higher level routine such as  or , the output values of  and  can be overridden via the  and  arguments by specifying list elements of the same names as the output values they are overriding. The outputs can also be fed to other, lower level routines such as .</p>

<p>Here we provide hints for enabling the parallelization hooks, via  for multi-core machines and  for graphics cards. The package also includes some wrapper functions, like , which allow a large predictive set to be divvied up amongst multiple nodes in a cluster established via the  or   packages.</p>

<p>Several routines in the  package include support for parallelization on multi-core machines. The most important one is , allowing large prediction problems to be divvied up and distributed across multiple threads to be run in parallel. The speedups are roughly linear as long as the numbers of threads is less than or equal to the number of cores. This is controlled through the  argument.</p>
<p>If  is compiled with  support enabled—which at the time of writing is standard in most builds—then no special action is needed in order to extend that functionality to . It will just work. One way to check if this is the case on your machine is to provide an  argument, say to , that is bigger than one. If  support is not enabled then you will get a warning. If you are working within a well-managed supercomputing facility, with a custom  compilation, it is likely that  has been properly compiled with  support. If not, perhaps it is worth requesting that it be re-compiled as there are many benefits to doing so, beyond those that extend to the  package. For example, many linear algebra intensive packages, of which  is one, benefit from linking to MKL libraries from Intel, in addition to . Note, however, that some customized libraries (e.g., ) are not compatible with  because they are not (at the time of writing) thread safe.</p>
<p>At the time of writing, some incompatibilities between multi-threaded BLAS (e.g., Intel MKL) and OpenMP (e.g., non-Intel, like with GCC) are still in the process of being resolved. In some builds and instantiations  can create nested  threads of different types (Intel for linear algebra, and GCC for parallel local design). Problematic behavior has been observed when using  with GCC OpenMP and MKL multi-threaded linear algebra. Generally speaking, since  uses threads to divvy up local design tasks, a threaded linear algebra subroutine library is not recommended in combination with these routines.</p>
<p>In the case where you are using a standard  binary, it is still possible to compile  from source with  features assuming your compiler (e.g., GCC) supports them. This is a worthwhile step if you are working on a multi-core machine, which is rapidly becoming the standard setup. For those with experience compiling  packages from source, the procedure is straightforward and does not require installing a bespoke version of . Obtain the package source (e.g., from CRAN) and, before compiling, open up the package and make two small edits to laGP/src/Makevars. These instructions assume a GCC compiler. For other compilers, please consult documentation for appropriate flags.</p>

<p>The laGP/src/Makevars file contains commented out lines which implement these changes. Once made, simply install the package as usual, either doing ``R CMD INSTALL’’ on the modified directory, or after re-tarring it up. Note that for Apple machines as of Xcode v5, with OSX Mavericks, the  compiler provided by Apple does not include OpenMP support. We suggest downloading GCC v9 or later, for example from , and following the instructions therein.</p>
<p>If hyperthreading is enabled, then a good default for  is two-times the number of cores. Choosing an  value which is greater than the max allowed by the  configuration on your machine leads to a notice being printed indicating that the max-value will be used instead.</p>

<p>The package supports graphics card acceleration of a key subroutine: searching for the next local design sight <span class="math inline">\(x_{j+1}\)</span> over a potentially vast number of candidates <span class="math inline">\(X_N \setminus X_n(x)\)</span>—Step 2(b) in Figure . Custom complication is required to enable this feature, the details of which are described here, and also requires a properly configured Nvidia Graphics card, drivers, and compilation programs (e.g., the Nvidia  compiler ). Compiling and linking to  libraries can be highly architecture and operating system specific, therefore the very basic instructions here may not work widely. They have been tested on a variety of Unix-alikes including Intel-based Ubuntu Linux and OSX systems.</p>
First compile the  file into an object using the Nvidia  complier. E.g., after untarring the package change into  and do

<p>Alternatively, you can use/edit the ``’’ definition in the  provided.</p>
<p>Then, make the following changes to , possibly augmenting changes made above to accommodate  support.  (i.e., using multiple CPU threads) brings out the best in our GPU implementation.</p>

<p>The  file contains commented out lines which implement these changes. Once made, simply install the package as usual. Alternatively, use  via the definitions in the  to compile a standalone shared object.</p>
<p>The four functions in the package with GPU support are , , , and . The first two have a simple switch which allows a single search (Step 2(b)) to be off-loaded to a single GPU. Both also support off-loading the same calculations to multiple cores in a CPU, via  if enabled. The latter  variations control the GPU interface via two arguments:  and . The former specifies how many GPUs you wish to use, and indicating more than you actually have will trip an error. The latter, which defaults to , specifies how many CPU threads should be used to queue GPU jobs. Having  is an inefficient use of resources, whereas , up to  will give modest speedups. Having multiple threads queue onto the same GPU reduces the amount of time the GPU is idle.  support must be included in the package to have more than one GPU thread.</p>
<p>By default,  is set to zero when  since divvying the work amongst GPU and CPU threads can present load balancing challenges. However, if you get the load balancing right you can observe substantial speedups.  saw up to 50% speedups, and recommend a scheme for allocating  with a setting of  that allocates about 90% of the work to GPUs () and 10% to the ten  threads. As with ,  maxes out at the maximum number of threads indicated by your  configuration. Moreover,  must not exceed that value. When that happens both are first thresholded independently, then  may be further reduced to stay within the limit.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>A footnote here.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
